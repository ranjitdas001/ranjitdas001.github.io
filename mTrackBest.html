<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Money Tracker Pro - India</title>
    
    <!-- Manifest for PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <meta name="description" content="Personal finance tracker for India with advanced analytics">
    
    <!-- PWA iOS support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MoneyTracker">
    
    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'slide-in-right': 'slideInRight 0.3s ease-out',
                        'slide-in-left': 'slideInLeft 0.3s ease-out',
                        'pulse-gentle': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-gentle': 'bounce 1s infinite',
                        'spin-slow': 'spin 3s linear infinite',
                        'shimmer': 'shimmer 2s infinite linear',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-primary: 79, 70, 229;
            --color-secondary: 16, 185, 129;
            --color-danger: 239, 68, 68;
            --color-warning: 245, 158, 11;
            --color-dark: 31, 41, 55;
            --color-light: 249, 250, 251;
        }

        * { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            box-sizing: border-box;
        }
        
        body { 
            overscroll-behavior-y: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Hide Scrollbar but keep functionality */
        .hide-scrollbar::-webkit-scrollbar { 
            display: none; 
            width: 0;
            height: 0;
        }
        .hide-scrollbar { 
            -ms-overflow-style: none; 
            scrollbar-width: none;
            scroll-behavior: smooth;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        /* Bottom Sheet */
        .bottom-sheet {
            transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
            will-change: transform;
        }
        .bottom-sheet-open { transform: translateY(0); }
        .bottom-sheet-closed { transform: translateY(100%); }

        /* Toast */
        @keyframes toastIn {
            from { 
                transform: translateX(-50%) translateY(100%); 
                opacity: 0; 
            }
            to { 
                transform: translateX(-50%) translateY(0); 
                opacity: 1; 
            }
        }
        .toast-enter { 
            animation: toastIn 0.3s ease-out forwards; 
        }

        /* Sticky Header with glass effect */
        .sticky-header {
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        .dark .sticky-header {
            background: rgba(31, 41, 55, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom components */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .dark .glass {
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.3);
            border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.5);
        }

        /* Safe area for modern devices */
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom, 0);
        }
        .pt-safe {
            padding-top: env(safe-area-inset-top, 0);
        }
        .pl-safe {
            padding-left: env(safe-area-inset-left, 0);
        }
        .pr-safe {
            padding-right: env(safe-area-inset-right, 0);
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(0, 0, 0, 0.06) 25%,
                rgba(0, 0, 0, 0.15) 37%,
                rgba(0, 0, 0, 0.06) 63%
            );
            background-size: 400% 100%;
            animation: shimmer 1.4s ease infinite;
        }
        .dark .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.06) 25%,
                rgba(255, 255, 255, 0.15) 37%,
                rgba(255, 255, 255, 0.06) 63%
            );
            background-size: 400% 100%;
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            .print\:block {
                display: block !important;
            }
            body {
                background: white !important;
                color: black !important;
            }
            .print-container {
                max-width: none !important;
                margin: 0 !important;
                padding: 20px !important;
                box-shadow: none !important;
                background: white !important;
            }
        }

        /* Focus styles for accessibility */
        .focus-ring {
            outline: 2px solid rgba(79, 70, 229, 0.5);
            outline-offset: 2px;
        }
        .focus-ring:focus {
            outline: 2px solid rgba(79, 70, 229, 1);
        }

        /* Swipe to delete */
        .swipe-transition {
            transition: transform 0.3s ease;
        }

        /* Pull to refresh */
        .pull-to-refresh {
            transition: transform 0.3s ease;
        }

        /* Custom checkbox */
        .custom-checkbox {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }
        .custom-checkbox:checked {
            background: #4F46E5;
            border-color: #4F46E5;
        }
        .custom-checkbox:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .dark .custom-checkbox {
            background: #374151;
            border-color: #4b5563;
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .dark .card-hover:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
    /* Add to the existing CSS styles */
#color-picker {
    scroll-behavior: smooth;
}

#color-picker button {
    flex-shrink: 0;
    transition: all 0.2s ease;
}

#color-picker button:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

#color-picker button.active {
    border-width: 3px;
    border-color: #4F46E5;
    transform: scale(1.1);
}

/* For very long color pickers */
#color-picker::-webkit-scrollbar {
    height: 4px;
}

#color-picker::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.05);
    border-radius: 2px;
}

#color-picker::-webkit-scrollbar-thumb {
    background: rgba(79, 70, 229, 0.3);
    border-radius: 2px;
}

.dark #color-picker::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
}

.dark #color-picker::-webkit-scrollbar-thumb {
    background: rgba(79, 70, 229, 0.5);
}
    
    /* Add these styles anywhere in the existing <style> section */

/* Fixed size category buttons */
.category-btn {
    width: 70px;
    height: 80px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.category-btn-small {
    width: 60px;
    height: 70px;
}

.category-btn-active {
    border-color: #4F46E5 !important;
    background-color: rgba(79, 70, 229, 0.1) !important;
}

/* Category icon container */
.category-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 6px;
    font-size: 14px;
}

.category-icon-small {
    width: 32px;
    height: 32px;
    font-size: 12px;
}

/* Category name */
.category-name {
    font-size: 10px;
    font-weight: 500;
    text-align: center;
    line-height: 1.2;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}
    
    
    </style>
</head>
<body class="bg-gray-50 text-gray-800 transition-colors duration-300 min-h-screen dark:bg-gray-900 dark:text-gray-100">
    
    <!-- App Container -->
    <div class="max-w-md mx-auto min-h-screen relative overflow-hidden bg-white dark:bg-gray-800 shadow-lg print:shadow-none" id="app-container">
        
        <!-- Header -->
        <header class="sticky-header sticky top-0 z-50 px-4 py-3 flex justify-between items-center pt-safe">
            <div class="flex items-center space-x-3">
                <div>
                    <h1 class="text-lg font-bold gradient-text">MoneyTracker</h1>
                    <p id="header-date" class="text-xs text-gray-500 dark:text-gray-400 truncate">Loading...</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button id="search-toggle" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center transition-colors hover:bg-gray-200 dark:hover:bg-gray-600" aria-label="Search">
                    <i class="fas fa-search text-gray-600 dark:text-gray-300 text-sm"></i>
                </button>
               
                
            </div>
        </header>

        <!-- Search Bar -->
        <div id="search-bar" class="hidden px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="relative">
                <input type="text" id="search-input" placeholder="Search transactions..." 
                       class="w-full pl-10 pr-10 py-2 bg-gray-100 dark:bg-gray-700 rounded-xl outline-none focus:ring-2 focus:ring-primary-500 dark:text-white text-sm"
                       aria-label="Search transactions">
                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                <button id="clear-search" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300" aria-label="Clear search">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        

        <!-- Loading Overlay -->
        <!-- <div id="loading-overlay" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col items-center justify-center">
            <div class="text-center">
                <div class="w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-gray-600 dark:text-gray-400 font-medium">Loading your finances...</p>
                <p class="text-xs text-gray-500 dark:text-gray-500 mt-2">MoneyTracker Pro v2.1</p>
            </div>
        </div> -->

        <!-- Offline Indicator -->
        <div id="offline-indicator" class="hidden fixed top-20 left-1/2 transform -translate-x-1/2 z-40 px-4 py-2 bg-yellow-500 text-white rounded-full text-sm font-medium shadow-lg">
            <i class="fas fa-wifi-slash mr-2"></i> You are offline
        </div>

        <!-- Main Views Container -->
        <main class="pb-20" id="main-content">
            
            <!-- Home View -->
            <div id="view-home" class="page-view animate-fade-in">
                <!-- Balance Card -->
                <div class="p-4">
                    <div class="bg-gradient-to-br from-primary-600 to-purple-700 rounded-2xl p-5 text-white shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mr-4 -mt-4 w-24 h-24 rounded-full bg-white opacity-10 blur-xl"></div>
                        <div class="absolute bottom-0 left-0 -ml-4 -mb-4 w-20 h-20 rounded-full bg-white opacity-10 blur-xl"></div>
                        
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm opacity-90 mb-1">Total Balance</p>
                                <h2 id="balance-amount" class="text-3xl font-bold">₹0.00</h2>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="app.switchView('reports')" class="px-3 py-1 bg-white/20 rounded-lg text-xs hover:bg-white/30 transition-colors" aria-label="Reports">
                                    <i class="fas fa-chart-line mr-1"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Income/Expense Cards -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            
                            <div class="flex items-center gap-4 bg-white/10 p-3 rounded-xl backdrop-blur-sm">
                                <div class="space-x-1 text-red-300 text-sm mb-1">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <p id="total-expense" class="font-semibold text-lg">₹0.00</p>
                            </div>
                            <div class="flex items-center gap-4 bg-white/10 p-3 rounded-xl backdrop-blur-sm">
                                <div class="space-x-1 text-green-300 text-sm mb-1">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                                <p id="total-income" class="font-semibold text-lg">₹0.00</p>
                            </div>
                        </div>

                        <!-- Budget Progress -->
                        <div class="mt-4 pt-3">                          
                            <div class="w-full bg-black/20 rounded-full h-2 mb-1">
                                <div id="budget-bar" class="h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span id="budget-label">Monthly Budget</span>
                                <span id="budget-percent" class="hidden">0%</span>
                                <span id="budget-used" class="hidden">₹0 used</span>
                                <span id="budget-remaining">₹0 remaining</span>
                            </div>
                            <p id="budget-alert" class="text-xs mt-1 hidden">
                                <i class="fas fa-exclamation-circle mr-1"></i>
                                <span id="budget-alert-text"></span>
                            </p>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex gap-3 mt-4">
                        <button onclick="app.openAddModal('expense')" class="w-full bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-3 flex flex-col items-center hover:bg-red-100 dark:hover:bg-red-900/30 transition-all active:scale-95" aria-label="Add expense">
                            <div class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-800 flex items-center justify-center mb-2">
                                <i class="fas fa-minus text-red-600 dark:text-red-400"></i>
                            </div>
                            <span class="text-xs font-medium text-red-700 dark:text-red-300">Expense</span>
                        </button>
                        
                        <button onclick="app.openAddModal('income')" class="w-full bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-3 flex flex-col items-center hover:bg-green-100 dark:hover:bg-green-900/30 transition-all active:scale-95" aria-label="Add income">
                            <div class="w-10 h-10 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center mb-2">
                                <i class="fas fa-plus text-green-600 dark:text-green-400"></i>
                            </div>
                            <span class="text-xs font-medium text-green-700 dark:text-green-300">Income</span>
                        </button>
                        
                        <!-- <button onclick="app.openFilterModal()" class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-3 flex flex-col items-center hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-all active:scale-95" aria-label="Filter">
                            <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center mb-2">
                                <i class="fas fa-filter text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <span class="text-xs font-medium text-blue-700 dark:text-blue-300">Filter</span>
                        </button>
                        
                        <button onclick="app.switchView('analytics')" class="bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-xl p-3 flex flex-col items-center hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-all active:scale-95" aria-label="Analytics">
                            <div class="w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-800 flex items-center justify-center mb-2">
                                <i class="fas fa-chart-pie text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <span class="text-xs font-medium text-purple-700 dark:text-purple-300">Stats</span>
                        </button> -->
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="px-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-bold text-lg dark:text-gray-200">Recent Transactions</h3>
                        <div class="flex space-x-1">
                            <button id="filter-activate-btn" onclick="app.toggleFilterBar()" class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors p-1" aria-label="Toggle filters">
                                <i class="fas fa-sliders-h"></i>
                            </button>
                            
                        </div>
                    </div>

                    <!-- Filter Bar -->
        <div id="filter-bar" class="hidden px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
            <div class="flex space-x-2 overflow-x-auto hide-scrollbar">
                <button onclick="app.setFilter('type', 'all')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-filter="type" data-value="all">
                    All
                </button>
                <button onclick="app.setFilter('type', 'income')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-filter="type" data-value="income">
                    Income
                </button>
                <button onclick="app.setFilter('type', 'expense')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300" data-filter="type" data-value="expense">
                    Expense
                </button>
                <button onclick="app.openDateRangePicker()" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-calendar-alt mr-1"></i> Date
                </button>
                <button onclick="app.openCategoryFilter()" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                    <i class="fas fa-tag mr-1"></i> Category
                </button>
                <button onclick="app.clearFilters()" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400">
                    <i class="fas fa-times mr-1"></i> Clear
                </button>
            </div>
        </div>
                    
                    <!-- Empty State -->
                    <div id="empty-state" class="hidden flex-col items-center justify-center py-12 text-center">
                        
                        <h4 class="font-semibold text-gray-500 dark:text-gray-400 mb-2">No transactions yet</h4><br>
                        <button onclick="app.openAddModal('expense')" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i> Add 
                        </button>
                    </div>
                    
                    <!-- Loading Skeleton -->
                    <div id="loading-skeleton" class="space-y-3">
                        <div class="skeleton h-16 rounded-xl"></div>
                        <div class="skeleton h-16 rounded-xl"></div>
                        <div class="skeleton h-16 rounded-xl"></div>
                    </div>
                    
                    <!-- Transactions List -->
                    <div id="transactions-list" class="space-y-3 min-h-[200px]">
                        <!-- Transactions will be loaded here -->
                    </div>
                    
                    <!-- Load More -->
                    <div id="load-more" class="mt-4 text-center hidden">
                        <button onclick="app.loadMoreTransactions()" class="px-4 py-2 text-sm text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300 transition-colors">
                            <i class="fas fa-chevron-down mr-2"></i> Load More
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div id="view-analytics" class="page-view hidden px-4 py-4 space-y-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold dark:text-white">Analytics Dashboard</h2>
                    <select id="analytics-period" onchange="app.updateAnalyticsPeriod(this.value)" class="px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                        <option value="month">This Month</option>
                        <option value="year">This Year</option>
                        <option value="week">This Week</option>
                        <option value="quarter">Last 3 Months</option>
                        <option value="all">All Time</option>
                    </select>
                </div>
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-4 text-white card-hover">
                        <p class="text-sm opacity-90 mb-1">Total Income</p>
                        <p id="analytics-income" class="text-2xl font-bold">₹0</p>
                        <p class="text-xs opacity-75 mt-1">This period</p>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-pink-600 rounded-xl p-4 text-white card-hover">
                        <p class="text-sm opacity-90 mb-1">Total Expense</p>
                        <p id="analytics-expense" class="text-2xl font-bold">₹0</p>
                        <p class="text-xs opacity-75 mt-1">This period</p>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="space-y-6">
                    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm card-hover">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400">EXPENSE BREAKDOWN</h3>
                            <div class="flex space-x-2">
                                <button onclick="app.toggleChartType('expenseChart')" class="text-xs text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                                <button onclick="app.downloadChart('expenseChart')" class="text-xs text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="h-64 relative">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm card-hover">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400">INCOME VS EXPENSE</h3>
                            <div class="flex space-x-2">
                                <button onclick="app.toggleChartType('trendChart')" class="text-xs text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                    <i class="fas fa-exchange-alt"></i>
                                </button>
                                <button onclick="app.downloadChart('trendChart')" class="text-xs text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="h-48 relative">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>

                    <!-- Insights -->
                    <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 shadow-sm card-hover">
                        <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-4">FINANCIAL INSIGHTS</h3>
                        <div id="insights-list" class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-lightbulb text-blue-600 dark:text-blue-400 text-sm"></i>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-300">
                                    Add your first transaction to see personalized insights
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div id="view-reports" class="page-view hidden px-4 py-4 space-y-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold dark:text-white">Financial Reports</h2>
                    <button onclick="app.generateFullReport()" class="px-3 py-1.5 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors">
                        <i class="fas fa-file-pdf mr-1"></i> Generate PDF
                    </button>
                </div>
                
                <!-- Report Type Selector -->
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <button onclick="app.generateReport('monthly')" class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4 text-center hover:border-primary-500 dark:hover:border-primary-500 transition-all active:scale-95">
                        <i class="fas fa-calendar-alt text-2xl text-primary-600 dark:text-primary-400 mb-2"></i>
                        <p class="font-semibold text-sm">Monthly</p>
                    </button>
                    <button onclick="app.generateReport('category')" class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4 text-center hover:border-primary-500 dark:hover:border-primary-500 transition-all active:scale-95">
                        <i class="fas fa-chart-pie text-2xl text-primary-600 dark:text-primary-400 mb-2"></i>
                        <p class="font-semibold text-sm">Category</p>
                    </button>
                    <button onclick="app.generateReport('comparison')" class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4 text-center hover:border-primary-500 dark:hover:border-primary-500 transition-all active:scale-95">
                        <i class="fas fa-chart-bar text-2xl text-primary-600 dark:text-primary-400 mb-2"></i>
                        <p class="font-semibold text-sm">Comparison</p>
                    </button>
                    <button onclick="app.generateReport('trend')" class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4 text-center hover:border-primary-500 dark:hover:border-primary-500 transition-all active:scale-95">
                        <i class="fas fa-chart-line text-2xl text-primary-600 dark:text-primary-400 mb-2"></i>
                        <p class="font-semibold text-sm">Trend</p>
                    </button>
                </div>

                <!-- Date Range Selector -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200">Report Period</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">From Date</label>
                            <input type="date" id="report-start-date" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">To Date</label>
                            <input type="date" id="report-end-date" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                </div>

                <!-- Report Container -->
                <div id="report-container" class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4 min-h-[200px]">
                    <div class="flex flex-col items-center justify-center py-8 text-gray-400 dark:text-gray-500">
                        <i class="fas fa-chart-bar text-4xl mb-3"></i>
                        <p class="text-sm">Select a report type to generate</p>
                        <p class="text-xs mt-1">Choose from options above</p>
                    </div>
                </div>

                <!-- Export Options -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200">Export Options</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="app.exportReport('pdf')" class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex flex-col items-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-all active:scale-95">
                            <i class="fas fa-file-pdf text-red-500 text-xl mb-2"></i>
                            <span class="text-xs">PDF</span>
                        </button>
                        <button onclick="app.exportReport('csv')" class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex flex-col items-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-all active:scale-95">
                            <i class="fas fa-file-csv text-green-500 text-xl mb-2"></i>
                            <span class="text-xs">CSV</span>
                        </button>
                        <button onclick="app.exportReport('excel')" class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex flex-col items-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-all active:scale-95">
                            <i class="fas fa-file-excel text-green-600 text-xl mb-2"></i>
                            <span class="text-xs">Excel</span>
                        </button>
                        <button onclick="app.printReport()" class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex flex-col items-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-all active:scale-95">
                            <i class="fas fa-print text-blue-500 text-xl mb-2"></i>
                            <span class="text-xs">Print</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="view-settings" class="page-view hidden px-4 py-4 space-y-6">
                <h2 class="text-xl font-bold mb-6 dark:text-white">Settings</h2>
                
                <!-- User Profile -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                            <i class="fas fa-user text-primary-600 dark:text-primary-400 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold dark:text-gray-200">User Profile</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Manage your account settings</p>
                        </div>
                        <button onclick="app.editProfile()" class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>

                <!-- Budget Settings -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200 flex items-center">
                        <i class="fas fa-wallet mr-2 text-primary-600"></i> Budget Settings
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Monthly Budget</label>
                            <div class="flex space-x-2">
                                <div class="relative flex-1">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">₹</span>
                                    <input type="number" id="budget-input" placeholder="Enter amount" 
                                           class="w-full pl-8 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-primary-500"
                                           min="0" step="100">
                                </div>
                                <button onclick="app.saveBudget()" class="px-4 py-2 bg-primary-600 text-white rounded-lg font-medium hover:bg-primary-700 transition-colors">
                                    Save
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                                    <input type="checkbox" id="budget-alerts" class="custom-checkbox">
                                    <span>Budget alerts</span>
                                </label>
                                <span class="text-xs text-gray-500">Get notified when approaching limit</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                                    <input type="checkbox" id="auto-budget" class="custom-checkbox">
                                    <span>Auto budget calculation</span>
                                </label>
                                <span class="text-xs text-gray-500">Based on past spending</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-tags mr-2 text-green-600"></i> Manage Categories
                        </div>
                        <button onclick="app.openCategoryManager()" class="text-xs text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                            Manage All
                        </button>
                    </h3>
                    
                    <!-- Add New Category -->
                    <div class="mb-4 p-0 bg-gray-50 dark:bg-gray-800 rounded-lg">
                        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Add New Category</h4>
                        <div class="space-y-3">
                            <div class="flex gap-2 w-full">
                                <input type="text" id="new-cat-name" placeholder="Category name" 
                                       class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white outline-none focus:ring-2 focus:ring-green-500 text-sm">
                                <select id="new-cat-type" class="p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white text-sm">
                                    <option value="expense">Expense</option>
                                    <option value="income">Income</option>
                                </select>
                            </div>
                            
                            <!-- Icon + Color Selection (Side by Side) -->
<div class="flex gap-4">

    <!-- Icon Selection -->
    <div class="w-1/2">
        <label class="block text-xs text-gray-500 dark:text-gray-400 mb-2">Select Icon</label>
        <div class="relative">
            <div class="flex overflow-x-auto space-x-2 py-2 hide-scrollbar" id="icon-picker">
                <!-- Icons will be loaded here -->
            </div>
            <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent dark:from-gray-800 dark:to-transparent pointer-events-none"></div>
        </div>
    </div>

    <!-- Color Selection -->
    <div class="w-1/2">
        <label class="block text-xs text-gray-500 dark:text-gray-400 mb-2">Select Color</label>
        <div class="relative">
            <div class="flex overflow-x-auto space-x-2 py-2 hide-scrollbar" id="color-picker">
                <!-- Colors will be loaded here -->
            </div>
            <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent dark:from-gray-800 dark:to-transparent pointer-events-none"></div>
        </div>
    </div>

</div>



                            <button onclick="app.addCustomCategory()" class="w-full bg-green-600 text-white py-2 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm">
                                <i class="fas fa-plus mr-2"></i> Add Category
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200 flex items-center">
                        <i class="fas fa-database mr-2 text-blue-600"></i> Data Management
                    </h3>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="app.exportData('json')" class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-all active:scale-95">
                                <i class="fas fa-file-export mr-2"></i>Export
                            </button>
                            <label class="border border-gray-300 dark:border-gray-600 rounded-lg py-3 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-all active:scale-95">
                                <i class="fas fa-file-import mr-2"></i>Import
                                <input type="file" id="import-file" class="hidden" accept=".json,.csv" onchange="app.importData(event)">
                            </label>
                        </div>
                        
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                                    <input type="checkbox" id="auto-backup" class="custom-checkbox">
                                    <span>Auto backup</span>
                                </label>
                                <span class="text-xs text-gray-500">Daily at 2 AM</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                                    <input type="checkbox" id="cloud-sync" class="custom-checkbox">
                                    <span>Cloud sync</span>
                                </label>
                                <span class="text-xs text-gray-500">Requires account</span>
                            </div>
                        </div>
                        
                        <button onclick="app.showBackupModal()" class="w-full text-center text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800 rounded-lg py-2 text-sm hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                            <i class="fas fa-cloud mr-2"></i>Manage Backups
                        </button>
                        
                        <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
                            <button onclick="app.clearAllData()" class="w-full text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20 rounded-lg py-3 text-sm font-medium hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors flex items-center justify-center">
                                <i class="fas fa-trash-alt mr-2"></i>Reset All Data
                            </button>
                            <p class="text-xs text-gray-500 dark:text-gray-400 text-center mt-2">This action cannot be undone</p>
                        </div>
                    </div>
                </div>

                <!-- App Settings -->
                <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-xl p-4">
                    <h3 class="font-semibold mb-3 dark:text-gray-200 flex items-center">
                        <i class="fas fa-cog mr-2 text-gray-600"></i> App Settings
                    </h3>
                    <div class="space-y-4">
                        <!-- Theme Settings -->
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-2">Theme</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button onclick="app.setTheme('light')" class="py-2 border rounded-lg flex flex-col items-center justify-center transition-all" id="theme-light">
                                    <i class="fas fa-sun text-yellow-500 mb-1"></i>
                                    <span class="text-xs">Light</span>
                                </button>
                                <button onclick="app.setTheme('dark')" class="py-2 border rounded-lg flex flex-col items-center justify-center transition-all" id="theme-dark">
                                    <i class="fas fa-moon text-indigo-500 mb-1"></i>
                                    <span class="text-xs">Dark</span>
                                </button>
                                <button onclick="app.setTheme('auto')" class="py-2 border rounded-lg flex flex-col items-center justify-center transition-all" id="theme-auto">
                                    <i class="fas fa-adjust text-gray-500 mb-1"></i>
                                    <span class="text-xs">Auto</span>
                                </button>
                            </div>
                        </div>

                        <!-- Currency -->
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Currency</label>
                            <select id="currency-select" onchange="app.changeCurrency(this.value)" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="INR">₹ Indian Rupee</option>
                                <option value="USD">$ US Dollar</option>
                                <option value="EUR">€ Euro</option>
                                <option value="GBP">£ British Pound</option>
                                <option value="JPY">¥ Japanese Yen</option>
                                <option value="AUD">A$ Australian Dollar</option>
                                <option value="CAD">C$ Canadian Dollar</option>
                            </select>
                        </div>

                        <!-- Language -->
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Language</label>
                            <select id="language-select" onchange="app.changeLanguage(this.value)" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="en">English</option>
                                <option value="hi">हिंदी (Hindi)</option>
                                <option value="ta">தமிழ் (Tamil)</option>
                                <option value="te">తెలుగు (Telugu)</option>
                                <option value="bn">বাংলা (Bengali)</option>
                                <option value="mr">मराठी (Marathi)</option>
                            </select>
                        </div>

                        <!-- Date Format -->
                        <div>
                            <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">Date Format</label>
                            <select id="date-format" onchange="app.changeDateFormat(this.value)" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                <option value="DD MMM YYYY">DD MMM YYYY</option>
                            </select>
                        </div>

                        <!-- App Version -->
                        <div class="pt-4 border-t border-gray-200 dark:border-gray-700 text-center">
                            <p class="text-sm text-gray-500 dark:text-gray-400">Money Tracker Pro v2.1</p>
                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">© 2024 All rights reserved</p>
                            <button onclick="app.showAbout()" class="text-xs text-primary-600 dark:text-primary-400 mt-2 hover:underline">
                                About & Privacy
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t dark:border-gray-700 pb-safe z-30 max-w-md mx-auto no-print">
            <div class="flex justify-around items-center h-16 px-2">
                <button onclick="app.switchView('home')" id="nav-home" class="nav-btn flex-1 flex flex-col items-center justify-center text-primary-600 dark:text-primary-400 transition-colors group">
                    <div class="relative">
                        <i class="fas fa-home text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                        <div class="absolute -top-1 -right-1 w-2 h-2 bg-primary-500 rounded-full hidden" id="nav-home-dot"></div>
                    </div>
                    <span class="text-[10px] font-medium">Home</span>
                </button>
                
                <button onclick="app.switchView('analytics')" id="nav-analytics" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors group">
                    <i class="fas fa-chart-pie text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] font-medium">Analytics</span>
                </button>
                
                <!-- FAB Button -->
                <!-- <div class="relative">
                    <button onclick="app.openAddModal()" class="w-14 h-14 bg-gradient-to-br from-primary-600 to-purple-600 rounded-full flex items-center justify-center text-white shadow-xl transform -translate-y-6 border-4 border-white dark:border-gray-900 hover:scale-105 transition-all active:scale-95" aria-label="Add transaction">
                        <i class="fas fa-plus text-2xl"></i>
                    </button>
                    <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full animate-pulse-gentle"></div>
                </div> -->

                <button onclick="app.switchView('reports')" id="nav-reports" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors group">
                    <i class="fas fa-chart-bar text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] font-medium">Reports</span>
                </button>
                
                <button onclick="app.switchView('settings')" id="nav-settings" class="nav-btn flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors group">
                    <i class="fas fa-cog text-xl mb-1 group-hover:scale-110 transition-transform"></i>
                    <span class="text-[10px] font-medium">Settings</span>
                </button>
            </div>
        </nav>

        <!-- Pull to Refresh Indicator -->
        <div id="pull-to-refresh" class="fixed top-0 left-0 right-0 h-12 flex items-center justify-center bg-white dark:bg-gray-800 shadow-lg transform -translate-y-full transition-transform z-40">
            <i class="fas fa-sync-alt animate-spin text-primary-600 mr-2"></i>
            <span class="text-sm text-gray-600 dark:text-gray-300">Refreshing...</span>
        </div>

    </div>

    <!-- MODALS -->
    
<!-- Add Transaction Modal -->
<div id="add-modal" class="fixed inset-0 z-40 hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="app.closeAddModal()"></div>
    <div class="absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-2xl p-4 shadow-2xl max-w-md mx-auto" id="sheet-content">
        <!-- Header -->
        <div class="flex items-center justify-around mb-4 pb-2 border-b dark:border-gray-700">
            
            <div class="h-1 bg-gray-400 dark:bg-gray-500 w-8 rounded-full mt-0.5"></div>
        </div>
        
        <!-- Compact Type Selector -->
        <div class="flex bg-gray-100 dark:bg-gray-700 p-0.5 rounded-lg mb-4">
            <button onclick="app.setTransType('expense')" id="btn-expense" class="flex-1 py-2 text-xs font-semibold bg-white text-gray-800 rounded-md shadow-sm transition-all">
                <i class="fas fa-minus mr-1.5"></i>Expense
            </button>
            <button onclick="app.setTransType('income')" id="btn-income" class="flex-1 py-2 text-xs font-medium text-gray-500 dark:text-gray-400 rounded-md transition-all">
                <i class="fas fa-plus mr-1.5"></i>Income
            </button>
        </div>

        <form id="transaction-form" class="space-y-3" onsubmit="event.preventDefault(); app.addTransaction();">
            <!-- Amount Row -->
            <div class="flex items-center space-x-3">
                <div class="flex-shrink-0">
                    <span class="text-gray-500 font-bold text-sm">₹</span>
                </div>
                <div class="flex-1">
                    <input type="number" id="inp-amount" step="0.01" min="0" required
                           class="w-full px-3 py-2.5 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-base font-bold outline-none focus:ring-1 focus:ring-primary-500 dark:text-white" 
                           placeholder="0.00" aria-label="Transaction amount">
                </div>
            </div>

            <!-- Category Selection -->
            <div>
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">CATEGORY</label>
                <div class="relative">
                    <div class="flex overflow-x-auto space-x-1.5 pb-1 hide-scrollbar" id="category-list">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>
                <input type="hidden" id="inp-category" required>
            </div>

            <!-- Date & Time in single row -->
            <div class="flex space-x-2">
                <div class="flex-1">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">DATE</label>
                    <input type="date" id="inp-date" required
                           class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
                </div>
                <div class="flex-1">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">TIME</label>
                    <input type="time" id="inp-time"
                           class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
                </div>
            </div>

            <!-- Note - Smaller -->
            <div>
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">NOTE (Optional)</label>
                <input type="text" id="inp-note" placeholder="Lunch, Uber, Salary..." maxlength="50"
                       class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
            </div>

            <!-- Payment Method & Status - Compact -->
            <div class="flex space-x-2">
                <div class="flex-1">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">PAYMENT</label>
                    <select id="inp-method" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="upi">UPI</option>
                    </select>
                </div>
                <div class="flex-1">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">STATUS</label>
                    <select id="inp-status" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
                        <option value="completed">✓</option>
                        <option value="pending">⏱</option>
                        <option value="failed">✗</option>
                    </select>
                </div>
            </div>

            <!-- Recurring Options - Only shown when toggled -->
            <div id="recurring-options" class="hidden">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5">REPEAT</label>
                <select id="inp-recurring" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-700 border-none rounded-lg text-xs outline-none focus:ring-1 focus:ring-primary-500 dark:text-white">
                    <option value="none">No Repeat</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                </select>
            </div>

            <!-- Toggle Options - Smaller -->
            <div class="flex justify-between items-center py-1">
                <label class="flex items-center space-x-1.5 text-xs text-gray-600 dark:text-gray-300 cursor-pointer">
                    <input type="checkbox" id="inp-recurring-toggle" class="w-3.5 h-3.5" onchange="app.toggleRecurringOptions()">
                    <span>Recurring</span>
                </label>
                <label class="flex items-center space-x-1.5 text-xs text-gray-600 dark:text-gray-300 cursor-pointer">
                    <input type="checkbox" id="inp-tax-deductible" class="w-3.5 h-3.5">
                    <span>Tax Deductible</span>
                </label>
            </div>

            <!-- Submit Button - Compact -->
            <button type="submit" class="w-full bg-gradient-to-r from-primary-600 to-purple-600 hover:from-primary-700 hover:to-purple-700 text-white text-sm font-semibold py-3 rounded-lg shadow transition-all active:scale-95 mt-2">
                <i class="fas fa-save mr-1.5"></i> Save
            </button>
        </form>
    </div>
</div>

    <!-- Add Transaction Modal -->
    <div id="add-modal" class="fixed inset-0 z-40 hidden" aria-hidden="true">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity" onclick="app.closeAddModal()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-3xl p-5 shadow-2xl bottom-sheet bottom-sheet-closed max-w-md mx-auto" id="sheet-content">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold dark:text-white">Add Transaction</h3>
                <button onclick="app.closeAddModal()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Type Selector -->
            <div class="flex bg-gray-100 dark:bg-gray-700 p-1 rounded-xl mb-6">
                <button onclick="app.setTransType('expense')" id="btn-expense" class="flex-1 py-3 rounded-lg text-sm font-semibold bg-white text-gray-800 shadow-sm transition-all">
                    <i class="fas fa-minus mr-2"></i>Expense
                </button>
                <button onclick="app.setTransType('income')" id="btn-income" class="flex-1 py-3 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 transition-all">
                    <i class="fas fa-plus mr-2"></i>Income
                </button>
            </div>

            <form id="transaction-form" class="space-y-4" onsubmit="event.preventDefault(); app.addTransaction();">
                <!-- Amount -->
                <div>
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">AMOUNT</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-bold" id="currency-symbol">₹</span>
                        <input type="number" id="inp-amount" step="0.01" min="0" required
                               class="w-full pl-8 pr-4 py-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-lg font-bold outline-none focus:ring-2 focus:ring-primary-500 dark:text-white" 
                               placeholder="0.00" aria-label="Transaction amount">
                    </div>
                </div>

                <!-- Category Selection - HORIZONTAL SCROLLABLE -->
                <div>
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">CATEGORY</label>
                    <div class="relative">
    <div class="flex overflow-x-auto space-x-2 pb-2 hide-scrollbar" id="category-list">
        <!-- Categories will be loaded here -->
    </div>
    <!-- Gradient fade for scroll indication -->
    <div class="absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-white to-transparent dark:from-gray-800 dark:to-transparent pointer-events-none"></div>
</div>
                    <input type="hidden" id="inp-category" required>
                </div>

                <!-- Date & Time -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">DATE</label>
                        <input type="date" id="inp-date" required
                               class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">TIME</label>
                        <input type="time" id="inp-time"
                               class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                    </div>
                </div>

                <!-- Note -->
                <div>
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">NOTE (Optional)</label>
                    <input type="text" id="inp-note" placeholder="Lunch, Uber, Salary..." maxlength="100"
                           class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                    <div class="text-right mt-1">
                        <span id="note-count" class="text-xs text-gray-400">0/100</span>
                    </div>
                </div>

                <!-- Payment Method & Status -->
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">PAYMENT METHOD</label>
                        <select id="inp-method" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="upi">UPI</option>
                            <option value="netbanking">Net Banking</option>
                            <option value="wallet">Wallet</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">STATUS</label>
                        <select id="inp-status" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                            <option value="completed">Completed</option>
                            <option value="pending">Pending</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                </div>

                <!-- Recurring Options -->
                <div id="recurring-options" class="hidden">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">RECURRING PATTERN</label>
                    <select id="inp-recurring" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border-none rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500 dark:text-white">
                        <option value="none">No Repeat</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <!-- Toggle Options -->
                <div class="flex justify-between items-center py-2">
                    <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                        <input type="checkbox" id="inp-recurring-toggle" class="custom-checkbox" onchange="app.toggleRecurringOptions()">
                        <span>Recurring</span>
                    </label>
                    <label class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300 cursor-pointer">
                        <input type="checkbox" id="inp-tax-deductible" class="custom-checkbox">
                        <span>Tax Deductible</span>
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="w-full bg-gradient-to-r from-primary-600 to-purple-600 hover:from-primary-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-primary-500/30 transition-all active:scale-95">
                    <i class="fas fa-save mr-2"></i> Save Transaction
                </button>
            </form>
        </div>
    </div>

    <!-- Category Manager Modal -->
    <div id="category-manager-modal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="app.closeCategoryManager()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-3xl p-5 shadow-2xl bottom-sheet bottom-sheet-closed max-w-md mx-auto h-5/6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold dark:text-white">Manage Categories</h3>
                <button onclick="app.closeCategoryManager()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4 h-[calc(100%-4rem)] overflow-hidden">
                <!-- Tabs -->
                <div class="flex border-b dark:border-gray-700">
                    <button onclick="app.setCategoryTab('expense')" id="cat-tab-expense" class="flex-1 py-2 text-sm font-medium border-b-2 border-primary-600 text-primary-600 dark:text-primary-400">
                        Expense Categories
                    </button>
                    <button onclick="app.setCategoryTab('income')" id="cat-tab-income" class="flex-1 py-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                        Income Categories
                    </button>
                </div>
                
                <!-- Categories List -->
                <div id="category-manager-list" class="overflow-y-auto h-[calc(100%-4rem)] custom-scrollbar">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filter-modal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="app.closeFilterModal()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-3xl p-5 shadow-2xl bottom-sheet bottom-sheet-closed max-w-md mx-auto h-4/6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold dark:text-white">Filter Transactions</h3>
                <button onclick="app.closeFilterModal()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- Date Range -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Range</label>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="date" id="filter-start-date" class="p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <input type="date" id="filter-end-date" class="p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                </div>

                <!-- Amount Range -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Amount Range</label>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="number" id="filter-min-amount" placeholder="Min" class="p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <input type="number" id="filter-max-amount" placeholder="Max" class="p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    </div>
                </div>

                <!-- Categories -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Categories</label>
                    <div id="filter-categories" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto custom-scrollbar p-2 border rounded-lg dark:border-gray-600">
                        <!-- Categories will be loaded here -->
                    </div>
                </div>

                <!-- Payment Methods -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Method</label>
                    <select id="filter-payment-method" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="all">All Methods</option>
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="upi">UPI</option>
                        <option value="netbanking">Net Banking</option>
                    </select>
                </div>

                <!-- Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                    <select id="filter-status" class="w-full p-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="all">All Status</option>
                        <option value="completed">Completed</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-3 pt-4">
                    <button onclick="app.applyFilters()" class="bg-primary-600 text-white py-3 rounded-lg font-semibold hover:bg-primary-700 transition-colors">
                        Apply Filters
                    </button>
                    <button onclick="app.clearFilters()" class="border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                        Clear All
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="app.closeAbout()"></div>
        <div class="absolute bottom-0 left-0 right-0 bg-white dark:bg-gray-800 rounded-t-3xl p-5 shadow-2xl bottom-sheet bottom-sheet-closed max-w-md mx-auto h-3/4">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold dark:text-white">About Money Tracker Pro</h3>
                <button onclick="app.closeAbout()" class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="space-y-6 overflow-y-auto h-[calc(100%-4rem)] custom-scrollbar">
                <div class="text-center">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-primary-600 to-purple-600 flex items-center justify-center">
                        <i class="fas fa-wallet text-3xl text-white"></i>
                    </div>
                    <h4 class="text-xl font-bold dark:text-white">Money Tracker Pro</h4>
                    <p class="text-gray-600 dark:text-gray-400">v2.1.0</p>
                </div>
                
                <div>
                    <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Features</h5>
                    <ul class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Track income and expenses</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Advanced analytics and charts</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Budget management</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Custom categories with icons</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Recurring transactions</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Export to PDF/CSV/Excel</li>
                        <li class="flex items-center"><i class="fas fa-check text-green-500 mr-2"></i> Dark/Light theme</li>
                    </ul>
                </div>
                
                <div>
                    <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Privacy</h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        All your financial data is stored locally on your device. We don't collect any personal information. Your data is never sent to any servers.
                    </p>
                </div>
                
                <div>
                    <h5 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Support</h5>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        For support or feature requests, please contact us at support@moneytracker.app
                    </p>
                </div>
                
                <div class="text-center pt-4 border-t dark:border-gray-700">
                    <p class="text-xs text-gray-500 dark:text-gray-400">© 2024 Money Tracker Pro. All rights reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center space-y-2 w-max pointer-events-none"></div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            });
        }
    </script>

    <!-- Main Application Script -->
    <script>2
        class MoneyTrackerApp {
            constructor() {
                // Initialize state
                this.state = {
                    transactions: [],
                    budget: 0,
                    customCategories: [],
                    settings: {
                        darkMode: 'auto',
                        currency: 'INR',
                        language: 'en',
                        dateFormat: 'DD/MM/YYYY',
                        budgetAlerts: true,
                        autoBackup: false,
                        cloudSync: false,
                        autoBudget: false
                    },
                    filters: {
                        search: '',
                        type: 'all',
                        category: 'all',
                        startDate: null,
                        endDate: null,
                        minAmount: null,
                        maxAmount: null,
                        paymentMethod: 'all',
                        status: 'all',
                        sortBy: 'date',
                        sortOrder: 'desc'
                    },
                    pagination: {
                        page: 1,
                        limit: 20,
                        hasMore: true
                    },
                    currentView: 'home',
                    currentTransactionType: 'expense',
                    selectedCategory: null,
                    analyticsPeriod: 'month'
                };
                
                // Default categories with icons and colors
                this.defaultCategories = {
                    expense: [
                        { id: 'food', name: 'Food & Dining', icon: 'fa-utensils', color: '#EF4444', type: 'expense' },
                        { id: 'transport', name: 'Transport', icon: 'fa-bus', color: '#3B82F6', type: 'expense' },
                        { id: 'shopping', name: 'Shopping', icon: 'fa-shopping-bag', color: '#8B5CF6', type: 'expense' },
                        { id: 'bills', name: 'Bills', icon: 'fa-bolt', color: '#F59E0B', type: 'expense' },
                        { id: 'entertainment', name: 'Entertainment', icon: 'fa-film', color: '#EC4899', type: 'expense' },
                        { id: 'health', name: 'Health', icon: 'fa-heartbeat', color: '#10B981', type: 'expense' },
                        { id: 'education', name: 'Education', icon: 'fa-graduation-cap', color: '#6366F1', type: 'expense' },
                        { id: 'personal', name: 'Personal Care', icon: 'fa-user', color: '#14B8A6', type: 'expense' },
                        { id: 'travel', name: 'Travel', icon: 'fa-plane', color: '#F97316', type: 'expense' },
                        { id: 'groceries', name: 'Groceries', icon: 'fa-shopping-cart', color: '#84CC16', type: 'expense' }
                    ],
                    income: [
                        { id: 'salary', name: 'Salary', icon: 'fa-briefcase', color: '#10B981', type: 'income' },
                        { id: 'freelance', name: 'Freelance', icon: 'fa-laptop-code', color: '#3B82F6', type: 'income' },
                        { id: 'investment', name: 'Investment', icon: 'fa-chart-line', color: '#8B5CF6', type: 'income' },
                        { id: 'gift', name: 'Gift', icon: 'fa-gift', color: '#EC4899', type: 'income' },
                        { id: 'rental', name: 'Rental Income', icon: 'fa-home', color: '#F59E0B', type: 'income' },
                        { id: 'business', name: 'Business', icon: 'fa-store', color: '#EF4444', type: 'income' },
                        { id: 'dividends', name: 'Dividends', icon: 'fa-money-bill-wave', color: '#84CC16', type: 'income' },
                        { id: 'refund', name: 'Refund', icon: 'fa-undo', color: '#6366F1', type: 'income' }
                    ]
                };
                
                // Currency settings
                this.currencies = {
                    'INR': { symbol: '₹', name: 'Indian Rupee', locale: 'en-IN' },
                    'USD': { symbol: '$', name: 'US Dollar', locale: 'en-US' },
                    'EUR': { symbol: '€', name: 'Euro', locale: 'en-EU' },
                    'GBP': { symbol: '£', name: 'British Pound', locale: 'en-GB' },
                    'JPY': { symbol: '¥', name: 'Japanese Yen', locale: 'ja-JP' },
                    'AUD': { symbol: 'A$', name: 'Australian Dollar', locale: 'en-AU' },
                    'CAD': { symbol: 'C$', name: 'Canadian Dollar', locale: 'en-CA' }
                };
                
                // Icon options for category creation
                this.iconOptions = [
                    'fa-utensils', 'fa-bus', 'fa-shopping-bag', 'fa-bolt', 'fa-film', 'fa-heartbeat',
                    'fa-graduation-cap', 'fa-user', 'fa-plane', 'fa-shopping-cart', 'fa-home',
                    'fa-car', 'fa-gas-pump', 'fa-mobile-alt', 'fa-wifi', 'fa-tv', 'fa-gamepad',
                    'fa-dumbbell', 'fa-prescription-bottle', 'fa-book', 'fa-palette', 'fa-music',
                    'fa-camera', 'fa-briefcase', 'fa-laptop-code', 'fa-chart-line', 'fa-gift',
                    'fa-store', 'fa-money-bill-wave', 'fa-undo', 'fa-coffee', 'fa-pizza-slice',
                    'fa-hamburger', 'fa-beer', 'fa-wine-glass-alt', 'fa-tshirt', 'fa-shoe-prints',
                    'fa-gem', 'fa-child', 'fa-baby', 'fa-paw', 'fa-seedling', 'fa-tree'
                ];
                
                // Color options for category creation
                this.colorOptions = [
                    '#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', '#EC4899',
                    '#6366F1', '#14B8A6', '#F97316', '#84CC16', '#06B6D4', '#8B5CF6',
                    '#D946EF', '#0EA5E9', '#22C55E', '#EAB308', '#EF4444', '#F97316'
                ];
                
                // Chart instances
                this.charts = {
                    expenseChart: null,
                    trendChart: null
                };
                
                // Debounce timers
                this.debounceTimers = {};
                
                // Initialize
                this.init();
            }
            
            // Initialization
            async init() {
                // Load data
                await this.loadData();
                
                // Set up event listeners
                this.setupEventListeners();
                
                // Update UI
                this.updateUI();
                
                // Check for recurring transactions
                this.checkRecurringTransactions();
                
                // Set up service worker
                this.setupServiceWorker();
                
                // Hide loading overlay
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                    this.showToast('Welcome to Money Tracker Pro!', 'success');
                }, 1000);
                
                // Check online status
                this.checkOnlineStatus();
            }
            
            // Data Management
            async loadData() {
                try {
                    // Load from localStorage
                    const savedState = localStorage.getItem('moneyTrackerState');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        this.state = { ...this.state, ...parsed };
                    }
                    
                    // Load transactions
                    const transactions = localStorage.getItem('moneyTrackerTransactions');
                    if (transactions) {
                        this.state.transactions = JSON.parse(transactions);
                    }
                    
                    // Load budget
                    const budget = localStorage.getItem('moneyTrackerBudget');
                    if (budget) {
                        this.state.budget = parseFloat(budget);
                    }
                    
                    // Load categories
                    const categories = localStorage.getItem('moneyTrackerCategories');
                    if (categories) {
                        this.state.customCategories = JSON.parse(categories);
                    }
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showToast('Error loading saved data', 'error');
                }
            }
            
            saveData() {
                try {
                    // Save to localStorage
                    localStorage.setItem('moneyTrackerState', JSON.stringify({
                        settings: this.state.settings,
                        filters: this.state.filters,
                        pagination: this.state.pagination
                    }));
                    
                    localStorage.setItem('moneyTrackerTransactions', JSON.stringify(this.state.transactions));
                    localStorage.setItem('moneyTrackerBudget', this.state.budget);
                    localStorage.setItem('moneyTrackerCategories', JSON.stringify(this.state.customCategories));
                    
                    // Create backup if auto backup is enabled
                    if (this.state.settings.autoBackup) {
                        this.createBackup();
                    }
                    
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showToast('Error saving data', 'error');
                }
            }
            
            // UI Updates
            updateUI() {
                this.updateTheme();
                this.updateHeader();
                this.updateBalance();
                this.renderTransactions();
                this.updateCurrencyDisplay();
                this.updateSettingsUI();
                this.renderCategoryButtons();
                this.renderIconPicker();
                this.renderColorPicker();
                this.updateFilterButtons();
            }
            
            updateTheme() {
                const theme = this.state.settings.darkMode;
                const html = document.documentElement;
                const themeToggle = document.getElementById('theme-toggle');
                
                if (theme === 'auto') {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (prefersDark) {
                        html.classList.add('dark');
                    } else {
                        html.classList.remove('dark');
                    }
                } else if (theme === 'dark') {
                    html.classList.add('dark');
                } else {
                    html.classList.remove('dark');
                }
                
                // Update theme toggle button
                if (themeToggle) {
                    const icon = themeToggle.querySelector('i');
                    if (html.classList.contains('dark')) {
                        icon.classList.remove('fa-moon', 'text-gray-600');
                        icon.classList.add('fa-sun', 'text-yellow-300');
                    } else {
                        icon.classList.remove('fa-sun', 'text-yellow-300');
                        icon.classList.add('fa-moon', 'text-gray-600');
                    }
                }
                
                // Update charts
                this.updateChartsTheme();
            }
            
            updateHeader() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                const dateStr = now.toLocaleDateString(this.state.settings.language === 'en' ? 'en-IN' : this.state.settings.language, options);
                document.getElementById('header-date').textContent = dateStr;
            }
            
            updateBalance() {
                const { income, expense } = this.calculateTotals();
                const balance = income - expense;
                const currency = this.currencies[this.state.settings.currency];
                
                // Format numbers
                const formatNumber = (num) => {
                    return num.toLocaleString(currency.locale, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                };
                
                // Update display
                document.getElementById('balance-amount').textContent = `${currency.symbol}${formatNumber(balance)}`;
                document.getElementById('total-income').textContent = `${currency.symbol}${formatNumber(income)}`;
                document.getElementById('total-expense').textContent = `${currency.symbol}${formatNumber(expense)}`;
                
                // Update analytics view if visible
                if (this.state.currentView === 'analytics') {
                    document.getElementById('analytics-income').textContent = `${currency.symbol}${formatNumber(income)}`;
                    document.getElementById('analytics-expense').textContent = `${currency.symbol}${formatNumber(expense)}`;
                }
                
                // Update budget progress
                this.updateBudgetProgress(expense);
            }
            
            updateBudgetProgress(expense) {
                const budget = this.state.budget;
                const currency = this.currencies[this.state.settings.currency];
                
                if (budget > 0) {
                    const percentage = Math.min((expense / budget) * 100, 100);
                    const remaining = Math.max(budget - expense, 0);
                    
                    const bar = document.getElementById('budget-bar');
                    const percentText = document.getElementById('budget-percent');
                    const usedText = document.getElementById('budget-used');
                    const remainingText = document.getElementById('budget-remaining');
                    const alert = document.getElementById('budget-alert');
                    
                    // Update progress bar
                    bar.style.width = `${percentage}%`;
                    percentText.textContent = `${Math.round(percentage)}%`;
                    
                    // Update text
                    usedText.textContent = `${currency.symbol}${expense.toLocaleString(currency.locale)} used`;
                    remainingText.textContent = `${currency.symbol}${remaining.toLocaleString(currency.locale)} remaining`;
                    
                    // Update bar color based on percentage
                    if (percentage >= 100) {
                        bar.className = 'h-2 rounded-full transition-all duration-500 bg-gradient-to-r from-red-500 to-red-600';
                        alert.classList.remove('hidden');
                        alert.className = 'text-xs mt-1 text-red-200';
                        alert.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i> Budget exceeded!';
                        
                        // Show notification if alerts are enabled
                        if (this.state.settings.budgetAlerts) {
                            this.showToast('Monthly budget exceeded!', 'warning');
                        }
                    } else if (percentage >= 80) {
                        bar.className = 'h-2 rounded-full transition-all duration-500 bg-gradient-to-r from-yellow-500 to-yellow-600';
                        alert.classList.remove('hidden');
                        alert.className = 'text-xs mt-1 text-yellow-200';
                        alert.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i> Approaching budget limit';
                    } else {
                        bar.className = 'h-2 rounded-full transition-all duration-500 bg-gradient-to-r from-green-500 to-green-600';
                        alert.classList.add('hidden');
                    }
                } else {
                    const bar = document.getElementById('budget-bar');
                    bar.style.width = '0%';
                    document.getElementById('budget-percent').textContent = '0%';
                    document.getElementById('budget-used').textContent = 'Set budget to track';
                    document.getElementById('budget-remaining').textContent = '';
                    document.getElementById('budget-alert').classList.add('hidden');
                }
            }
            
            // Transactions
            calculateTotals(transactions = null) {
                const trans = transactions || this.getFilteredTransactions();
                const income = trans
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                const expense = trans
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                return { income, expense };
            }
            
            getFilteredTransactions() {
                let filtered = [...this.state.transactions];
                const filters = this.state.filters;
                
                // Apply search filter
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    filtered = filtered.filter(t => 
                        t.note?.toLowerCase().includes(searchTerm) ||
                        t.category?.toLowerCase().includes(searchTerm) ||
                        this.getCategoryName(t.category, t.type).toLowerCase().includes(searchTerm)
                    );
                }
                
                // Apply type filter
                if (filters.type !== 'all') {
                    filtered = filtered.filter(t => t.type === filters.type);
                }
                
                // Apply category filter
                if (filters.category !== 'all') {
                    filtered = filtered.filter(t => t.category === filters.category);
                }
                
                // Apply date range filter
                if (filters.startDate) {
                    filtered = filtered.filter(t => new Date(t.date) >= new Date(filters.startDate));
                }
                if (filters.endDate) {
                    filtered = filtered.filter(t => new Date(t.date) <= new Date(filters.endDate));
                }
                
                // Apply amount range filter
                if (filters.minAmount !== null) {
                    filtered = filtered.filter(t => t.amount >= filters.minAmount);
                }
                if (filters.maxAmount !== null) {
                    filtered = filtered.filter(t => t.amount <= filters.maxAmount);
                }
                
                // Apply payment method filter
                if (filters.paymentMethod !== 'all') {
                    filtered = filtered.filter(t => t.method === filters.paymentMethod);
                }
                
                // Apply status filter
                if (filters.status !== 'all') {
                    filtered = filtered.filter(t => t.status === filters.status);
                }
                
                // Apply sorting
                filtered.sort((a, b) => {
                    const aDate = new Date(a.date);
                    const bDate = new Date(b.date);
                    
                    if (filters.sortBy === 'date') {
                        return filters.sortOrder === 'desc' ? bDate - aDate : aDate - bDate;
                    } else if (filters.sortBy === 'amount') {
                        return filters.sortOrder === 'desc' ? b.amount - a.amount : a.amount - b.amount;
                    }
                    return bDate - aDate;
                });
                
                return filtered;
            }
            
            renderTransactions() {
                const container = document.getElementById('transactions-list');
                const emptyState = document.getElementById('empty-state');
                const loadingSkeleton = document.getElementById('loading-skeleton');
                const loadMoreBtn = document.getElementById('load-more');
                
                const filtered = this.getFilteredTransactions();
                const totalTransactions = filtered.length;
                const { page, limit } = this.state.pagination;
                const startIndex = 0;
                const endIndex = page * limit;
                const transactionsToShow = filtered.slice(startIndex, endIndex);
                
                // Hide loading skeleton
                if (loadingSkeleton) {
                    loadingSkeleton.style.display = 'none';
                }
                
                if (totalTransactions === 0) {
                    container.innerHTML = '';
                    emptyState.classList.remove('hidden');
                    if (loadMoreBtn) loadMoreBtn.classList.add('hidden');
                    return;
                }
                
                emptyState.classList.add('hidden');
                container.innerHTML = '';
                
                // Group transactions by date
                const grouped = this.groupTransactionsByDate(transactionsToShow);
                
                Object.keys(grouped).forEach(date => {
                    // Add date header
                    const header = document.createElement('div');
                    header.className = 'sticky-header sticky top-12 z-10 py-2 px-1 text-xs font-bold text-gray-500 dark:text-gray-400 mb-2';
                    header.textContent = this.formatDateHeader(date);
                    container.appendChild(header);
                    
                    // Add transactions for this date
                    grouped[date].forEach(transaction => {
                        container.appendChild(this.createTransactionElement(transaction));
                    });
                });
                
                // Show/hide load more button
                if (endIndex < totalTransactions) {
                    if (loadMoreBtn) {
                        loadMoreBtn.classList.remove('hidden');
                        this.state.pagination.hasMore = true;
                    }
                } else {
                    if (loadMoreBtn) {
                        loadMoreBtn.classList.add('hidden');
                        this.state.pagination.hasMore = false;
                    }
                }
            }
            
            groupTransactionsByDate(transactions) {
                return transactions.reduce((groups, transaction) => {
                    const date = transaction.date.split('T')[0];
                    if (!groups[date]) {
                        groups[date] = [];
                    }
                    groups[date].push(transaction);
                    return groups;
                }, {});
            }
            
            formatDateHeader(dateString) {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                
                if (dateString === today) return 'Today';
                if (dateString === yesterday) return 'Yesterday';
                
                const date = new Date(dateString);
                return date.toLocaleDateString(this.state.settings.language, {
                    weekday: 'long',
                    month: 'short',
                    day: 'numeric'
                });
            }
            
            createTransactionElement(transaction) {
                const element = document.createElement('div');
                element.className = 'transaction-item bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-3 flex items-center justify-between cursor-pointer hover:shadow-md transition-all active:scale-[0.98]';
                element.dataset.id = transaction.id;
                
                const isExpense = transaction.type === 'expense';
                const category = this.getCategoryDetails(transaction.category, transaction.type);
                const currency = this.currencies[this.state.settings.currency];
                
                element.innerHTML = `
                    <div class="flex items-center space-x-3 flex-1" onclick="app.editTransaction('${transaction.id}')">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background-color: ${category.color}20; color: ${category.color};">
                            <i class="fas ${category.icon}"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-sm dark:text-gray-200 truncate">${transaction.note || category.name}</p>
                            <div class="flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400">
                                <span class="capitalize">${category.name}</span>
                                <span>•</span>
                                <span class="capitalize">${transaction.method}</span>
                                ${transaction.recurring ? '<span class="text-primary-600 dark:text-primary-400"><i class="fas fa-sync-alt text-xs"></i></span>' : ''}
                                ${transaction.taxDeductible ? '<span class="text-green-600 dark:text-green-400"><i class="fas fa-percentage text-xs"></i></span>' : ''}
                            </div>
                            <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">
                                ${this.formatDateTime(transaction.date)}
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-col items-center space-x-3">
                        <p class="font-bold text-lg ${isExpense ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'}">
                            ${isExpense ? '-' : '+'}${currency.symbol}${transaction.amount.toLocaleString(currency.locale, { minimumFractionDigits: 2 })}
                        </p>
                        <div class="flex space-x-1">
                            <button onclick="event.stopPropagation(); app.editTransaction('${transaction.id}')" class="w-8 h-8 rounded-full flex items-center justify-center transition-colors" aria-label="Edit transaction">
                                <i class="fas fa-edit text-gray-500/80 text-xs"></i>
                            </button>
                            <button onclick="event.stopPropagation(); app.deleteTransaction('${transaction.id}')" class="w-8 h-8 rounded-full flex items-center justify-center transition-colors" aria-label="Delete transaction">
                                <i class="fas fa-trash text-gray-500/80 text-xs"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                return element;
            }
            
            // Categories
            getCategoryDetails(categoryId, type) {
                // Check default categories
                const defaults = this.defaultCategories[type] || [];
                const defaultCat = defaults.find(c => c.id === categoryId);
                if (defaultCat) return defaultCat;
                
                // Check custom categories
                const customCat = this.state.customCategories.find(c => c.id === categoryId);
                if (customCat) return customCat;
                
                // Return default "other" category
                return {
                    id: 'other',
                    name: 'Other',
                    icon: 'fa-circle',
                    color: type === 'expense' ? '#6B7280' : '#10B981',
                    type: type
                };
            }
            
            getCategoryName(categoryId, type) {
                const cat = this.getCategoryDetails(categoryId, type);
                return cat.name;
            }
            
            getAllCategories() {
                return [
                    ...this.defaultCategories.expense,
                    ...this.defaultCategories.income,
                    ...this.state.customCategories
                ];
            }
            
            // Category Buttons - HORIZONTAL SCROLLABLE
            renderCategoryButtons(type = null) {
    const container = document.getElementById('category-list');
    if (!container) return;
    
    container.innerHTML = '';
    const currentType = type || this.state.currentTransactionType;
    const categories = this.getCategoriesByType(currentType);
    
    categories.forEach((cat, index) => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `category-btn border rounded-lg ${index === 0 ? 'category-btn-active' : 'border-gray-200 dark:border-gray-700'}`;
        button.onclick = () => this.selectCategory(cat.id, button);
        button.innerHTML = `
            <div class="category-icon" style="background-color: ${cat.color}20; color: ${cat.color};">
                <i class="fas ${cat.icon}"></i>
            </div>
            <span class="category-name dark:text-gray-300">${cat.name}</span>
        `;
        container.appendChild(button);
        
        if (index === 0) {
            document.getElementById('inp-category').value = cat.id;
        }
    });
    
    // Add "Add Category" button at the end
    const addButton = document.createElement('button');
    addButton.type = 'button';
    addButton.className = 'category-btn border border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20';
    addButton.onclick = () => this.openCategoryManager();
    addButton.innerHTML = `
        <div class="category-icon bg-gray-100 dark:bg-gray-700 text-gray-400">
            <i class="fas fa-plus"></i>
        </div>
        <span class="category-name text-gray-500 dark:text-gray-400">Add New</span>
    `;
    container.appendChild(addButton);
}
            
            getCategoriesByType(type) {
                const defaultCats = this.defaultCategories[type] || [];
                const customCats = this.state.customCategories.filter(c => c.type === type);
                return [...defaultCats, ...customCats];
            }
            
            selectCategory(categoryId, buttonElement) {
    document.getElementById('inp-category').value = categoryId;
    
    // Remove active style from all buttons
    const buttons = document.getElementById('category-list').children;
    for (let btn of buttons) {
        btn.classList.remove('category-btn-active');
        btn.classList.remove('border-primary-600', 'bg-primary-50', 'dark:bg-primary-900/30');
        btn.classList.add('border-gray-200', 'dark:border-gray-700');
    }
    
    // Add active style to selected button
    buttonElement.classList.remove('border-gray-200', 'dark:border-gray-700');
    buttonElement.classList.add('category-btn-active');
}
            
  renderEditCategoryButtons(type, selectedCategory) {
    const container = document.getElementById('edit-category-grid');
    if (!container) return;
    
    container.innerHTML = '';
    
    const categories = this.getCategoriesByType(type);
    
    // Change container to horizontal scroll
    container.className = 'flex overflow-x-auto space-x-2 pb-2 hide-scrollbar';
    
    categories.forEach(cat => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `category-btn border rounded-lg ${cat.id === selectedCategory ? 'category-btn-active' : 'border-gray-200 dark:border-gray-700'}`;
        button.onclick = () => {
            document.getElementById('edit-category').value = cat.id;
            // Update all buttons
            container.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('category-btn-active');
                btn.classList.add('border-gray-200', 'dark:border-gray-700');
            });
            button.classList.add('category-btn-active');
            button.classList.remove('border-gray-200', 'dark:border-gray-700');
        };
        button.innerHTML = `
            <div class="category-icon" style="background-color: ${cat.color}20; color: ${cat.color};">
                <i class="fas ${cat.icon}"></i>
            </div>
            <span class="category-name dark:text-gray-300">${cat.name}</span>
        `;
        container.appendChild(button);
    });
}          
            
            // Icon Picker for Category Creation
            renderIconPicker() {
    const container = document.getElementById('icon-picker');
    if (!container) return;
    
    container.innerHTML = '';
    this.iconOptions.forEach((icon, index) => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center border hover:border-primary-500 transition-all ${index === 0 ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/30' : 'border-gray-200 dark:border-gray-700'}`;
        button.onclick = () => this.selectIcon(icon, button);
        button.innerHTML = `<i class="fas ${icon} text-lg text-gray-600 dark:text-gray-300"></i>`;
        container.appendChild(button);
        
        if (index === 0) {
            this.selectedIcon = icon;
        }
    });
}
            
            selectIcon(icon, buttonElement) {
                this.selectedIcon = icon;
                
                // Remove active style from all buttons
                const buttons = document.getElementById('icon-picker').children;
                for (let btn of buttons) {
                    btn.classList.remove('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/30');
                    btn.classList.add('border-gray-200', 'dark:border-gray-700');
                }
                
                // Add active style to selected button
                buttonElement.classList.remove('border-gray-200', 'dark:border-gray-700');
                buttonElement.classList.add('border-primary-500', 'bg-primary-50', 'dark:bg-primary-900/30');
            }
            
            // Color Picker for Category Creation
            renderColorPicker() {
    const container = document.getElementById('color-picker');
    if (!container) return;
    
    container.innerHTML = '';
    this.colorOptions.forEach((color, index) => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `w-8 h-8 rounded-full border-2 flex-shrink-0 ${index === 0 ? 'border-gray-300 dark:border-gray-600' : 'border-transparent'} transition-all hover:scale-110`;
        button.style.backgroundColor = color;
        button.onclick = () => this.selectColor(color, button);
        container.appendChild(button);
        
        if (index === 0) {
            // Set default color
            this.selectedColor = color;
        }
    });
    
    // Add visual feedback if there are many colors
    if (this.colorOptions.length > 8) {
        container.parentElement.classList.add('has-scroll');
    }
}
            
            selectColor(color, buttonElement) {
    this.selectedColor = color;
    
    // Remove border from all buttons
    const buttons = document.getElementById('color-picker').children;
    for (let btn of buttons) {
        btn.classList.remove('border-gray-300', 'dark:border-gray-600', 'active');
        btn.classList.add('border-transparent');
    }
    
    // Add border to selected button
    buttonElement.classList.remove('border-transparent');
    buttonElement.classList.add('border-gray-300', 'dark:border-gray-600', 'active');
}
            
            // Charts
            renderCharts() {
                this.renderExpenseChart();
                this.renderTrendChart();
                this.generateInsights();
            }
            
            renderExpenseChart() {
                const ctx = document.getElementById('expenseChart');
                if (!ctx) return;
                
                // Destroy existing chart
                if (this.charts.expenseChart) {
                    this.charts.expenseChart.destroy();
                }
                
                // Get expense data for current period
                const expenses = this.getTransactionsForPeriod(this.state.analyticsPeriod)
                    .filter(t => t.type === 'expense');
                
                // Group by category
                const categoryTotals = {};
                expenses.forEach(t => {
                    const cat = this.getCategoryDetails(t.category, 'expense');
                    categoryTotals[cat.name] = (categoryTotals[cat.name] || 0) + t.amount;
                });
                
                const labels = Object.keys(categoryTotals);
                const data = Object.values(categoryTotals);
                
                // If no data, show message
                if (labels.length === 0) {
                    ctx.parentElement.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500">
                            <i class="fas fa-chart-pie text-3xl mb-2"></i>
                            <p class="text-sm">No expense data</p>
                        </div>
                    `;
                    return;
                }
                
                // Get theme colors
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? '#374151' : '#E5E7EB';
                
                // Create chart
                this.charts.expenseChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: this.generateChartColors(labels.length),
                            borderWidth: 0,
                            hoverOffset: 15
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: textColor,
                                    padding: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#1F2937' : '#FFFFFF',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: isDark ? '#374151' : '#E5E7EB',
                                borderWidth: 1,
                                callbacks: {
                                    label: (context) => {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        const currency = this.currencies[this.state.settings.currency];
                                        return `${label}: ${currency.symbol}${value.toLocaleString(currency.locale)} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        cutout: '65%'
                    }
                });
            }
            
            renderTrendChart() {
                const ctx = document.getElementById('trendChart');
                if (!ctx) return;
                
                // Destroy existing chart
                if (this.charts.trendChart) {
                    this.charts.trendChart.destroy();
                }
                
                // Get data for last 6 months
                const months = [];
                const incomeData = [];
                const expenseData = [];
                
                for (let i = 5; i >= 0; i--) {
                    const date = new Date();
                    date.setMonth(date.getMonth() - i);
                    const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    const monthLabel = date.toLocaleDateString(this.state.settings.language, { month: 'short' });
                    
                    months.push(monthLabel);
                    
                    const monthTransactions = this.state.transactions.filter(t => {
                        const tDate = new Date(t.date);
                        return tDate.getFullYear() === date.getFullYear() && 
                               tDate.getMonth() === date.getMonth();
                    });
                    
                    const income = monthTransactions
                        .filter(t => t.type === 'income')
                        .reduce((sum, t) => sum + t.amount, 0);
                    
                    const expense = monthTransactions
                        .filter(t => t.type === 'expense')
                        .reduce((sum, t) => sum + t.amount, 0);
                    
                    incomeData.push(income);
                    expenseData.push(expense);
                }
                
                // If no data, show message
                if (incomeData.every(v => v === 0) && expenseData.every(v => v === 0)) {
                    ctx.parentElement.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500">
                            <i class="fas fa-chart-line text-3xl mb-2"></i>
                            <p class="text-sm">No trend data available</p>
                        </div>
                    `;
                    return;
                }
                
                // Get theme colors
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? '#374151' : '#E5E7EB';
                
                // Create chart
                this.charts.trendChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Income',
                                data: incomeData,
                                backgroundColor: isDark ? '#10B981' : '#34D399',
                                borderRadius: 6,
                                borderSkipped: false
                            },
                            {
                                label: 'Expense',
                                data: expenseData,
                                backgroundColor: isDark ? '#EF4444' : '#F87171',
                                borderRadius: 6,
                                borderSkipped: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor,
                                    callback: (value) => {
                                        const currency = this.currencies[this.state.settings.currency];
                                        return `${currency.symbol}${value.toLocaleString(currency.locale)}`;
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: textColor
                                }
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#1F2937' : '#FFFFFF',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: isDark ? '#374151' : '#E5E7EB',
                                borderWidth: 1,
                                callbacks: {
                                    label: (context) => {
                                        const label = context.dataset.label || '';
                                        const value = context.raw || 0;
                                        const currency = this.currencies[this.state.settings.currency];
                                        return `${label}: ${currency.symbol}${value.toLocaleString(currency.locale)}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            updateChartsTheme() {
                Object.values(this.charts).forEach(chart => {
                    if (chart) {
                        const isDark = document.documentElement.classList.contains('dark');
                        const textColor = isDark ? '#E5E7EB' : '#374151';
                        const gridColor = isDark ? '#374151' : '#E5E7EB';
                        
                        // Update chart options
                        chart.options.plugins.legend.labels.color = textColor;
                        chart.options.scales.x.ticks.color = textColor;
                        chart.options.scales.y.ticks.color = textColor;
                        chart.options.scales.y.grid.color = gridColor;
                        
                        // Update tooltip colors
                        chart.options.plugins.tooltip.backgroundColor = isDark ? '#1F2937' : '#FFFFFF';
                        chart.options.plugins.tooltip.titleColor = textColor;
                        chart.options.plugins.tooltip.bodyColor = textColor;
                        chart.options.plugins.tooltip.borderColor = gridColor;
                        
                        chart.update();
                    }
                });
            }
            
            generateChartColors(count) {
                const colors = [
                    '#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6', 
                    '#EC4899', '#6366F1', '#14B8A6', '#F97316', '#84CC16'
                ];
                
                // Repeat colors if needed
                const result = [];
                for (let i = 0; i < count; i++) {
                    result.push(colors[i % colors.length]);
                }
                return result;
            }
            
            getTransactionsForPeriod(period) {
                const now = new Date();
                let startDate = new Date();
                
                switch (period) {
                    case 'week':
                        startDate.setDate(now.getDate() - 7);
                        break;
                    case 'month':
                        startDate.setMonth(now.getMonth() - 1);
                        break;
                    case 'quarter':
                        startDate.setMonth(now.getMonth() - 3);
                        break;
                    case 'year':
                        startDate.setFullYear(now.getFullYear() - 1);
                        break;
                    case 'all':
                        startDate = new Date(0); // Beginning of time
                        break;
                    default: // month
                        startDate.setMonth(now.getMonth() - 1);
                }
                
                return this.state.transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate >= startDate && tDate <= now;
                });
            }
            
            generateInsights() {
                const insightsList = document.getElementById('insights-list');
                if (!insightsList) return;
                
                insightsList.innerHTML = '';
                const { income, expense } = this.calculateTotals();
                const savings = income - expense;
                const savingsRate = income > 0 ? (savings / income) * 100 : 0;
                
                const insights = [];
                
                if (income === 0 && expense === 0) {
                    insights.push({
                        icon: 'fa-info-circle',
                        color: 'blue',
                        text: 'Add your first transaction to start tracking your finances.'
                    });
                } else {
                    // Savings rate insight
                    if (savingsRate >= 30) {
                        insights.push({
                            icon: 'fa-trophy',
                            color: 'green',
                            text: `Excellent! You're saving ${savingsRate.toFixed(1)}% of your income.`
                        });
                    } else if (savingsRate >= 20) {
                        insights.push({
                            icon: 'fa-thumbs-up',
                            color: 'green',
                            text: `Good job! You're saving ${savingsRate.toFixed(1)}% of your income.`
                        });
                    } else if (savingsRate >= 10) {
                        insights.push({
                            icon: 'fa-check-circle',
                            color: 'yellow',
                            text: `You're saving ${savingsRate.toFixed(1)}% of your income. Try to reach 20%.`
                        });
                    } else if (savingsRate >= 0) {
                        insights.push({
                            icon: 'fa-exclamation-circle',
                            color: 'yellow',
                            text: `Low savings rate (${savingsRate.toFixed(1)}%). Aim for at least 20%.`
                        });
                    } else {
                        insights.push({
                            icon: 'fa-exclamation-triangle',
                            color: 'red',
                            text: `You're spending ${Math.abs(savingsRate).toFixed(1)}% more than you earn.`
                        });
                    }
                    
                    // Expense category insight
                    const expenses = this.state.transactions.filter(t => t.type === 'expense');
                    if (expenses.length > 0) {
                        const categoryTotals = {};
                        expenses.forEach(t => {
                            categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
                        });
                        
                        const largestCategory = Object.entries(categoryTotals)
                            .reduce((a, b) => a[1] > b[1] ? a : b);
                        
                        if (largestCategory) {
                            const catName = this.getCategoryName(largestCategory[0], 'expense');
                            const percentage = ((largestCategory[1] / expense) * 100).toFixed(1);
                            insights.push({
                                icon: 'fa-chart-pie',
                                color: 'purple',
                                text: `Your largest expense is ${catName} (${percentage}% of total).`
                            });
                        }
                    }
                    
                    // Budget insight
                    if (this.state.budget > 0) {
                        const budgetPercentage = (expense / this.state.budget) * 100;
                        if (budgetPercentage >= 90) {
                            insights.push({
                                icon: 'fa-exclamation-triangle',
                                color: 'red',
                                text: `You've used ${budgetPercentage.toFixed(1)}% of your monthly budget.`
                            });
                        }
                    }
                }
                
                // Add insights to DOM
                insights.forEach(insight => {
                    const div = document.createElement('div');
                    div.className = 'flex items-start space-x-3';
                    div.innerHTML = `
                        <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0" 
                             style="background-color: ${this.getColorHex(insight.color)}20; color: ${this.getColorHex(insight.color)};">
                            <i class="fas ${insight.icon} text-sm"></i>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 flex-1">${insight.text}</p>
                    `;
                    insightsList.appendChild(div);
                });
            }
            
            getColorHex(colorName) {
                const colorMap = {
                    'red': '#EF4444',
                    'yellow': '#F59E0B',
                    'green': '#10B981',
                    'blue': '#3B82F6',
                    'purple': '#8B5CF6',
                    'pink': '#EC4899'
                };
                return colorMap[colorName] || '#6B7280';
            }
            
            // View Management
            switchView(viewName) {
                // Hide all views
                document.querySelectorAll('.page-view').forEach(el => {
                    el.classList.add('hidden');
                    el.classList.remove('animate-fade-in');
                });
                
                // Show selected view
                const view = document.getElementById(`view-${viewName}`);
                if (view) {
                    view.classList.remove('hidden');
                    view.classList.add('animate-fade-in');
                    this.state.currentView = viewName;
                    
                    // Update navigation
                    this.updateNavigation(viewName);
                    
                    // View-specific initialization
                    switch (viewName) {
                        case 'analytics':
                            setTimeout(() => this.renderCharts(), 100);
                            break;
                        case 'reports':
                            this.setupReportDates();
                            break;
                        case 'settings':
                            this.updateSettingsUI();
                            break;
                    }
                }
            }
            
            updateNavigation(viewName) {
                // Remove active class from all nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('text-primary-600', 'dark:text-primary-400');
                    btn.classList.add('text-gray-400');
                });
                
                // Add active class to current nav button
                const navBtn = document.getElementById(`nav-${viewName}`);
                if (navBtn) {
                    navBtn.classList.add('text-primary-600', 'dark:text-primary-400');
                    navBtn.classList.remove('text-gray-400');
                }
            }
            
            // Modal Management
            openAddModal(type = 'expense') {
                const modal = document.getElementById('add-modal');
                modal.classList.remove('hidden');
                
                setTimeout(() => {
                    const sheet = document.getElementById('sheet-content');
                    sheet.classList.remove('bottom-sheet-closed');
                    sheet.classList.add('bottom-sheet-open');
                }, 10);
                
                // Set transaction type
                this.setTransType(type);
                
                // Set default values
                document.getElementById('inp-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('inp-time').value = new Date().toTimeString().slice(0, 5);
                document.getElementById('inp-amount').value = '';
                document.getElementById('inp-note').value = '';
                document.getElementById('inp-method').value = 'cash';
                document.getElementById('inp-status').value = 'completed';
                document.getElementById('inp-recurring').value = 'none';
                document.getElementById('inp-recurring-toggle').checked = false;
                document.getElementById('inp-tax-deductible').checked = false;
                document.getElementById('recurring-options').classList.add('hidden');
                
                // Set note counter
                document.getElementById('note-count').textContent = '0/100';
            }
            
            closeAddModal() {
                const sheet = document.getElementById('sheet-content');
                sheet.classList.remove('bottom-sheet-open');
                sheet.classList.add('bottom-sheet-closed');
                
                setTimeout(() => {
                    document.getElementById('add-modal').classList.add('hidden');
                }, 300);
            }
            
            setTransType(type) {
                this.state.currentTransactionType = type;
                const btnExpense = document.getElementById('btn-expense');
                const btnIncome = document.getElementById('btn-income');
                
                if (type === 'expense') {
                    btnExpense.className = 'flex-1 py-3 rounded-lg text-sm font-semibold bg-white text-gray-800 shadow-sm transition-all';
                    btnIncome.className = 'flex-1 py-3 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 transition-all';
                } else {
                    btnIncome.className = 'flex-1 py-3 rounded-lg text-sm font-semibold bg-white text-gray-800 shadow-sm transition-all';
                    btnExpense.className = 'flex-1 py-3 rounded-lg text-sm font-medium text-gray-500 dark:text-gray-400 transition-all';
                }
                
                this.renderCategoryButtons(type);
            }
            
            toggleRecurringOptions() {
                const recurringToggle = document.getElementById('inp-recurring-toggle');
                const recurringOptions = document.getElementById('recurring-options');
                
                if (recurringToggle.checked) {
                    recurringOptions.classList.remove('hidden');
                } else {
                    recurringOptions.classList.add('hidden');
                }
            }
            
            // Category Manager
            openCategoryManager() {
                const modal = document.getElementById('category-manager-modal');
                modal.classList.remove('hidden');
                
                setTimeout(() => {
                    const sheet = modal.querySelector('.bottom-sheet');
                    sheet.classList.remove('bottom-sheet-closed');
                    sheet.classList.add('bottom-sheet-open');
                }, 10);
                
                this.setCategoryTab('expense');
            }
            
            closeCategoryManager() {
                const modal = document.getElementById('category-manager-modal');
                const sheet = modal.querySelector('.bottom-sheet');
                
                sheet.classList.remove('bottom-sheet-open');
                sheet.classList.add('bottom-sheet-closed');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
            
            setCategoryTab(tab) {
                // Update tab buttons
                const expenseTab = document.getElementById('cat-tab-expense');
                const incomeTab = document.getElementById('cat-tab-income');
                
                expenseTab.className = tab === 'expense' 
                    ? 'flex-1 py-2 text-sm font-medium border-b-2 border-primary-600 text-primary-600 dark:text-primary-400'
                    : 'flex-1 py-2 text-sm font-medium text-gray-500 dark:text-gray-400';
                
                incomeTab.className = tab === 'income'
                    ? 'flex-1 py-2 text-sm font-medium border-b-2 border-primary-600 text-primary-600 dark:text-primary-400'
                    : 'flex-1 py-2 text-sm font-medium text-gray-500 dark:text-gray-400';
                
                // Load categories for this tab
                this.loadCategoryManagerList(tab);
            }
            
            loadCategoryManagerList(type) {
    const container = document.getElementById('category-manager-list');
    if (!container) return;
    
    const categories = this.getCategoriesByType(type);
    
    if (categories.length === 0) {
        container.innerHTML = `
            <div class="flex flex-col items-center justify-center py-12 text-center">
                <i class="fas fa-tag text-4xl text-gray-300 dark:text-gray-600 mb-3"></i>
                <p class="text-gray-500 dark:text-gray-400">No ${type} categories yet</p>
            </div>
        `;
        return;
    }
    
    // Use grid layout for better spacing
    let html = '<div class="grid grid-cols-3 gap-2">';
    
    categories.forEach(cat => {
        const isCustom = cat.id.startsWith('cust_');
        html += `
            <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-2 text-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center mx-auto mb-2" style="background-color: ${cat.color}20; color: ${cat.color};">
                    <i class="fas ${cat.icon}"></i>
                </div>
                <p class="text-xs font-medium dark:text-gray-200 truncate mb-1">${cat.name}</p>
                <div class="flex justify-center space-x-1">
                    ${isCustom ? `
                        <button onclick="app.editCustomCategory('${cat.id}')" class="w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-900/30" aria-label="Edit">
                            <i class="fas fa-edit text-blue-600 dark:text-blue-400 text-xs"></i>
                        </button>
                        <button onclick="app.deleteCustomCategory('${cat.id}')" class="w-6 h-6 rounded-full bg-red-100 dark:bg-red-900/20 flex items-center justify-center hover:bg-red-200 dark:hover:bg-red-900/30" aria-label="Delete">
                            <i class="fas fa-trash text-red-600 dark:text-red-400 text-xs"></i>
                        </button>
                    ` : `
                        <span class="text-xs text-gray-400 px-1 rounded bg-gray-100 dark:bg-gray-800">Default</span>
                    `}
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}
            
            
            // Filter Management
            updateFilterButtons() {
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(btn => {
                    const filter = btn.dataset.filter;
                    const value = btn.dataset.value;
                    
                    if (filter && this.state.filters[filter] === value) {
                        btn.classList.add('bg-primary-600', 'text-white');
                        btn.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    }
                });
            }
            
            setFilter(filter, value) {
                this.state.filters[filter] = value;
                this.state.pagination.page = 1;
                this.updateFilterButtons();
                this.renderTransactions();
                this.saveData();
            }
            
            openFilterModal() {
                const modal = document.getElementById('filter-modal');
                modal.classList.remove('hidden');
                
                setTimeout(() => {
                    const sheet = modal.querySelector('.bottom-sheet');
                    sheet.classList.remove('bottom-sheet-closed');
                    sheet.classList.add('bottom-sheet-open');
                }, 10);
                
                // Populate filter categories
                this.populateFilterCategories();
            }
            
            closeFilterModal() {
                const modal = document.getElementById('filter-modal');
                const sheet = modal.querySelector('.bottom-sheet');
                
                sheet.classList.remove('bottom-sheet-open');
                sheet.classList.add('bottom-sheet-closed');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
            
            populateFilterCategories() {
    const container = document.getElementById('filter-categories');
    if (!container) return;
    
    const allCategories = this.getAllCategories();
    container.innerHTML = '';
    
    // Change to horizontal scroll layout
    container.className = 'flex overflow-x-auto space-x-2 pb-2 hide-scrollbar p-2';
    
    // Add "All" button
    const allButton = document.createElement('button');
    allButton.type = 'button';
    allButton.className = `category-btn-small border rounded-lg ${this.state.filters.category === 'all' ? 'bg-primary-600 text-white border-primary-600' : 'bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300'}`;
    allButton.innerHTML = `
        <div class="category-icon-small bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300">
            <i class="fas fa-layer-group"></i>
        </div>
        <span class="category-name">All</span>
    `;
    allButton.onclick = () => {
        this.state.filters.category = 'all';
        this.populateFilterCategories();
        this.renderTransactions();
    };
    container.appendChild(allButton);
    
    // Add category buttons
    allCategories.forEach(cat => {
        const isSelected = this.state.filters.category === cat.id;
        const button = document.createElement('button');
        button.type = 'button';
        button.className = `category-btn-small border rounded-lg ${isSelected ? 'border-primary-600 bg-primary-50 dark:bg-primary-900/30' : 'border-gray-200 dark:border-gray-700'}`;
        button.innerHTML = `
            <div class="category-icon-small" style="background-color: ${cat.color}20; color: ${cat.color};">
                <i class="fas ${cat.icon}"></i>
            </div>
            <span class="category-name dark:text-gray-300">${cat.name}</span>
        `;
        button.onclick = () => {
            this.state.filters.category = isSelected ? 'all' : cat.id;
            this.populateFilterCategories();
            this.renderTransactions();
        };
        container.appendChild(button);
    });
}
            
            applyFilters() {
                const startDate = document.getElementById('filter-start-date').value;
                const endDate = document.getElementById('filter-end-date').value;
                const minAmount = document.getElementById('filter-min-amount').value;
                const maxAmount = document.getElementById('filter-max-amount').value;
                const paymentMethod = document.getElementById('filter-payment-method').value;
                const status = document.getElementById('filter-status').value;
                
                this.state.filters = {
                    ...this.state.filters,
                    startDate: startDate || null,
                    endDate: endDate || null,
                    minAmount: minAmount ? parseFloat(minAmount) : null,
                    maxAmount: maxAmount ? parseFloat(maxAmount) : null,
                    paymentMethod: paymentMethod,
                    status: status
                };
                
                this.state.pagination.page = 1;
                this.renderTransactions();
                this.closeFilterModal();
                this.showToast('Filters applied', 'success');
                this.saveData();
            }
            
            clearFilters() {
                this.state.filters = {
                    search: '',
                    type: 'all',
                    category: 'all',
                    startDate: null,
                    endDate: null,
                    minAmount: null,
                    maxAmount: null,
                    paymentMethod: 'all',
                    status: 'all',
                    sortBy: 'date',
                    sortOrder: 'desc'
                };
                
                this.state.pagination.page = 1;
                
                // Reset filter inputs
                const filterModal = document.getElementById('filter-modal');
                if (filterModal && !filterModal.classList.contains('hidden')) {
                    document.getElementById('filter-start-date').value = '';
                    document.getElementById('filter-end-date').value = '';
                    document.getElementById('filter-min-amount').value = '';
                    document.getElementById('filter-max-amount').value = '';
                    document.getElementById('filter-payment-method').value = 'all';
                    document.getElementById('filter-status').value = 'all';
                }
                
                this.renderTransactions();
                this.closeFilterModal();
                this.showToast('Filters cleared', 'info');
                this.saveData();
            }
            
            toggleFilterBar() {
                const filterBar = document.getElementById('filter-bar');
                filterBar.classList.toggle('hidden');
      
            }
            
            // Transaction CRUD
            addTransaction() {
                const form = document.getElementById('transaction-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const amount = parseFloat(document.getElementById('inp-amount').value);
                const category = document.getElementById('inp-category').value;
                const note = document.getElementById('inp-note').value;
                const date = document.getElementById('inp-date').value;
                const time = document.getElementById('inp-time').value || '00:00';
                const method = document.getElementById('inp-method').value;
                const status = document.getElementById('inp-status').value;
                const recurring = document.getElementById('inp-recurring-toggle').checked;
                const recurringPattern = document.getElementById('inp-recurring').value;
                const taxDeductible = document.getElementById('inp-tax-deductible').checked;
                const type = this.state.currentTransactionType;
                
                if (!amount || amount <= 0) {
                    this.showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                if (!category) {
                    this.showToast('Please select a category', 'error');
                    return;
                }
                
                const transaction = {
                    id: `trans_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    type: type,
                    amount: amount,
                    category: category,
                    note: note,
                    date: `${date}T${time}`,
                    method: method,
                    status: status,
                    recurring: recurring,
                    recurringPattern: recurringPattern,
                    taxDeductible: taxDeductible,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.state.transactions.unshift(transaction);
                this.saveData();
                this.updateUI();
                
                if (this.state.currentView === 'analytics') {
                    this.renderCharts();
                }
                
                this.closeAddModal();
                this.showToast('Transaction added successfully', 'success');
            }
            
            editTransaction(id) {
                const transaction = this.state.transactions.find(t => t.id === id);
                if (!transaction) return;
                
                // For now, open the add modal with transaction data
                // In a full implementation, you would have a separate edit modal
                this.openAddModal(transaction.type);
                
                // Populate form with transaction data
                setTimeout(() => {
                    document.getElementById('inp-amount').value = transaction.amount;
                    document.getElementById('inp-category').value = transaction.category;
                    document.getElementById('inp-note').value = transaction.note || '';
                    document.getElementById('inp-date').value = transaction.date.split('T')[0];
                    document.getElementById('inp-time').value = transaction.date.split('T')[1]?.slice(0, 5) || '00:00';
                    document.getElementById('inp-method').value = transaction.method;
                    document.getElementById('inp-status').value = transaction.status;
                    document.getElementById('inp-recurring-toggle').checked = transaction.recurring;
                    document.getElementById('inp-recurring').value = transaction.recurringPattern || 'none';
                    document.getElementById('inp-tax-deductible').checked = transaction.taxDeductible || false;
                    
                    // Update category selection
                    this.renderCategoryButtons(transaction.type);
                    setTimeout(() => {
                        const categoryList = document.getElementById('category-list');
                        const buttons = categoryList.getElementsByTagName('button');
                        for (let btn of buttons) {
                            if (btn.textContent.includes(this.getCategoryName(transaction.category, transaction.type))) {
                                btn.click();
                                break;
                            }
                        }
                    }, 100);
                    
                    // Set transaction type
                    this.setTransType(transaction.type);
                    
                    // Store editing id
                    this.editingTransactionId = id;
                }, 100);
            }
            
            deleteTransaction(id) {
                if (!confirm('Are you sure you want to delete this transaction?')) {
                    return;
                }
                
                this.state.transactions = this.state.transactions.filter(t => t.id !== id);
                this.saveData();
                this.updateUI();
                
                if (this.state.currentView === 'analytics') {
                    this.renderCharts();
                }
                
                this.showToast('Transaction deleted', 'info');
            }
            
            // Category Management
            addCustomCategory() {
                const nameInput = document.getElementById('new-cat-name');
                const typeSelect = document.getElementById('new-cat-type');
                
                const name = nameInput?.value.trim();
                const type = typeSelect?.value;
                const icon = this.selectedIcon || 'fa-tag';
                const color = this.selectedColor || '#6B7280';
                
                if (!name) {
                    this.showToast('Please enter a category name', 'error');
                    return;
                }
                
                // Check for duplicate name
                const allCategories = this.getAllCategories();
                if (allCategories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                    this.showToast('Category with this name already exists', 'error');
                    return;
                }
                
                const newCategory = {
                    id: `cust_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    name: name,
                    type: type,
                    icon: icon,
                    color: color
                };
                
                this.state.customCategories.push(newCategory);
                this.saveData();
                
                // Reset form
                if (nameInput) nameInput.value = '';
                
                // Update UI
                this.renderCategoryButtons();
                this.loadCategoryManagerList(type);
                this.showToast('Category added successfully', 'success');
            }
            
            editCustomCategory(id) {
                const category = this.state.customCategories.find(c => c.id === id);
                if (!category) return;
                
                // In a full implementation, you would open an edit modal
                // For now, we'll just delete and let user create new
                this.deleteCustomCategory(id);
            }
            
            deleteCustomCategory(id) {
                if (!confirm('Delete this category? Transactions using this category will be moved to "Other".')) {
                    return;
                }
                
                // Move transactions to "Other" category
                this.state.transactions = this.state.transactions.map(t => {
                    if (t.category === id) {
                        return { ...t, category: 'other' };
                    }
                    return t;
                });
                
                // Remove category
                this.state.customCategories = this.state.customCategories.filter(c => c.id !== id);
                
                this.saveData();
                this.updateUI();
                this.showToast('Category deleted', 'info');
            }
            
            // Budget Management
            saveBudget() {
                const input = document.getElementById('budget-input');
                const budget = parseFloat(input?.value);
                
                if (isNaN(budget) || budget < 0) {
                    this.showToast('Please enter a valid budget amount', 'error');
                    return;
                }
                
                this.state.budget = budget;
                this.saveData();
                this.updateBudgetProgress(this.calculateTotals().expense);
                this.showToast('Budget updated successfully', 'success');
            }
            
            // Settings Management
            updateSettingsUI() {
                // Update theme buttons
                const theme = this.state.settings.darkMode;
                document.getElementById('theme-light').className = `py-2 border rounded-lg flex flex-col items-center justify-center transition-all ${theme === 'light' ? 'border-primary-600 bg-primary-50 dark:bg-primary-900/30' : ''}`;
                document.getElementById('theme-dark').className = `py-2 border rounded-lg flex flex-col items-center justify-center transition-all ${theme === 'dark' ? 'border-primary-600 bg-primary-50 dark:bg-primary-900/30' : ''}`;
                document.getElementById('theme-auto').className = `py-2 border rounded-lg flex flex-col items-center justify-center transition-all ${theme === 'auto' ? 'border-primary-600 bg-primary-50 dark:bg-primary-900/30' : ''}`;
                
                // Update currency
                document.getElementById('currency-select').value = this.state.settings.currency;
                document.getElementById('currency-symbol').textContent = this.currencies[this.state.settings.currency].symbol;
                
                // Update language
                document.getElementById('language-select').value = this.state.settings.language;
                
                // Update date format
                document.getElementById('date-format').value = this.state.settings.dateFormat;
                
                // Update budget input
                const budgetInput = document.getElementById('budget-input');
                if (budgetInput) {
                    budgetInput.value = this.state.budget > 0 ? this.state.budget : '';
                }
                
                // Update checkboxes
                document.getElementById('budget-alerts').checked = this.state.settings.budgetAlerts;
                document.getElementById('auto-backup').checked = this.state.settings.autoBackup;
                document.getElementById('cloud-sync').checked = this.state.settings.cloudSync;
                document.getElementById('auto-budget').checked = this.state.settings.autoBudget;
                
                // Update custom categories list
                this.renderCustomCategoriesList();
            }
            
            renderCustomCategoriesList() {
                const container = document.getElementById('custom-categories-list');
                if (!container) return;
                
                if (this.state.customCategories.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4 text-gray-400 dark:text-gray-500">
                            <i class="fas fa-tag text-2xl mb-2"></i>
                            <p class="text-sm">No custom categories yet</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="space-y-2">';
                
                this.state.customCategories.forEach(cat => {
                    html += `
                        <div class="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 rounded-full flex items-center justify-center" style="background-color: ${cat.color}20; color: ${cat.color};">
                                    <i class="fas ${cat.icon} text-xs"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium dark:text-gray-200">${cat.name}</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 capitalize">${cat.type}</p>
                                </div>
                            </div>
                            <button onclick="app.deleteCustomCategory('${cat.id}')" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            setTheme(theme) {
                this.state.settings.darkMode = theme;
                this.saveData();
                this.updateTheme();
            }
            
            changeCurrency(currency) {
                this.state.settings.currency = currency;
                this.saveData();
                this.updateUI();
                this.showToast(`Currency changed to ${this.currencies[currency].name}`, 'success');
            }
            
            changeLanguage(language) {
                this.state.settings.language = language;
                this.saveData();
                this.updateHeader();
                this.showToast(`Language changed`, 'success');
            }
            
            changeDateFormat(format) {
                this.state.settings.dateFormat = format;
                this.saveData();
                this.showToast(`Date format updated`, 'success');
            }
            
            updateCurrencyDisplay() {
                const symbol = this.currencies[this.state.settings.currency].symbol;
                document.getElementById('currency-symbol').textContent = symbol;
            }
            
            // Reports
            setupReportDates() {
                const today = new Date();
                const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                
                document.getElementById('report-start-date').value = firstDayOfMonth.toISOString().split('T')[0];
                document.getElementById('report-end-date').value = today.toISOString().split('T')[0];
            }
            
            generateReport(type) {
                const container = document.getElementById('report-container');
                if (!container) return;
                
                const startDate = document.getElementById('report-start-date').value;
                const endDate = document.getElementById('report-end-date').value;
                
                if (!startDate || !endDate) {
                    this.showToast('Please select start and end dates', 'error');
                    return;
                }
                
                const currency = this.currencies[this.state.settings.currency];
                
                // Filter transactions for date range
                const filteredTransactions = this.state.transactions.filter(t => {
                    const tDate = new Date(t.date);
                    return tDate >= new Date(startDate) && tDate <= new Date(endDate);
                });
                
                const { income, expense } = this.calculateTotals(filteredTransactions);
                const savings = income - expense;
                
                let reportHTML = '';
                
                switch (type) {
                    case 'monthly':
                        reportHTML = `
                            <div class="space-y-6">
                                <div class="text-center">
                                    <h4 class="text-lg font-bold dark:text-white">Monthly Financial Report</h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">
                                        ${this.formatDate(new Date(startDate))} - ${this.formatDate(new Date(endDate))}
                                    </p>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
                                        <p class="text-sm text-green-600 dark:text-green-400">Total Income</p>
                                        <p class="text-2xl font-bold">${currency.symbol}${income.toLocaleString(currency.locale, { minimumFractionDigits: 2 })}</p>
                                    </div>
                                    <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg">
                                        <p class="text-sm text-red-600 dark:text-red-400">Total Expense</p>
                                        <p class="text-2xl font-bold">${currency.symbol}${expense.toLocaleString(currency.locale, { minimumFractionDigits: 2 })}</p>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                                    <p class="text-sm text-blue-600 dark:text-blue-400">Net Savings</p>
                                    <p class="text-2xl font-bold ${savings >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${savings >= 0 ? '+' : ''}${currency.symbol}${Math.abs(savings).toLocaleString(currency.locale, { minimumFractionDigits: 2 })}
                                    </p>
                                </div>
                                
                                <div>
                                    <h5 class="font-semibold dark:text-gray-200 mb-3">Transaction Summary</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Total Transactions:</span>
                                            <span class="font-medium">${filteredTransactions.length}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Income Transactions:</span>
                                            <span class="font-medium text-green-600">${filteredTransactions.filter(t => t.type === 'income').length}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Expense Transactions:</span>
                                            <span class="font-medium text-red-600">${filteredTransactions.filter(t => t.type === 'expense').length}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'category':
                        // Category breakdown
                        const expenses = filteredTransactions.filter(t => t.type === 'expense');
                        const categoryTotals = {};
                        
                        expenses.forEach(t => {
                            const cat = this.getCategoryDetails(t.category, 'expense');
                            categoryTotals[cat.name] = (categoryTotals[cat.name] || 0) + t.amount;
                        });
                        
                        let categoryHTML = '<h4 class="font-bold text-lg dark:text-white mb-4">Expense by Category</h4><div class="space-y-3">';
                        
                        Object.entries(categoryTotals)
                            .sort((a, b) => b[1] - a[1])
                            .forEach(([category, amount]) => {
                                const percentage = expense > 0 ? ((amount / expense) * 100).toFixed(1) : '0.0';
                                categoryHTML += `
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span>${category}</span>
                                            <span>${currency.symbol}${amount.toLocaleString(currency.locale)} (${percentage}%)</span>
                                        </div>
                                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                            <div class="bg-primary-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                                        </div>
                                    </div>
                                `;
                            });
                        
                        categoryHTML += '</div>';
                        reportHTML = categoryHTML;
                        break;
                        
                    case 'comparison':
                        // Month-over-month comparison
                        reportHTML = '<div class="text-center py-8"><p class="text-gray-500 dark:text-gray-400">Comparison report will be available in the next update</p></div>';
                        break;
                        
                    case 'trend':
                        // Trend analysis
                        reportHTML = '<div class="text-center py-8"><p class="text-gray-500 dark:text-gray-400">Trend analysis will be available in the next update</p></div>';
                        break;
                }
                
                container.innerHTML = reportHTML;
            }
            
            generateFullReport() {
                this.showToast('Full report generation will be available in the next update', 'info');
            }
            
            exportReport(format) {
                switch (format) {
                    case 'pdf':
                        this.showToast('PDF export will be available in the next update', 'info');
                        break;
                    case 'csv':
                        this.exportToCSV();
                        break;
                    case 'excel':
                        this.showToast('Excel export will be available in the next update', 'info');
                        break;
                }
            }
            
            printReport() {
                window.print();
            }
            
            // Export/Import
            exportData(format = 'json') {
                const data = {
                    transactions: this.state.transactions,
                    budget: this.state.budget,
                    customCategories: this.state.customCategories,
                    settings: this.state.settings,
                    exportedAt: new Date().toISOString(),
                    version: '2.1'
                };
                
                if (format === 'json') {
                    const dataStr = JSON.stringify(data, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `money_tracker_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    URL.revokeObjectURL(url);
                    this.showToast('Data exported successfully', 'success');
                }
            }
            
            exportToCSV() {
                const headers = ['Date', 'Type', 'Category', 'Note', 'Amount', 'Payment Method', 'Status', 'Recurring'];
                const currency = this.currencies[this.state.settings.currency];
                
                const rows = this.state.transactions.map(t => [
                    this.formatDate(new Date(t.date)),
                    t.type,
                    this.getCategoryName(t.category, t.type),
                    `"${t.note || ''}"`,
                    t.amount,
                    t.method,
                    t.status,
                    t.recurring ? 'Yes' : 'No'
                ]);
                
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `transactions_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                URL.revokeObjectURL(url);
                this.showToast('CSV exported successfully', 'success');
            }
            
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (!data.version || data.version < '2.0') {
                            if (!confirm('This backup file is from an older version. Some data might not import correctly. Continue?')) {
                                return;
                            }
                        }
                        
                        if (data.transactions) {
                            this.state.transactions = data.transactions;
                        }
                        if (data.budget !== undefined) {
                            this.state.budget = data.budget;
                        }
                        if (data.customCategories) {
                            this.state.customCategories = data.customCategories;
                        }
                        if (data.settings) {
                            this.state.settings = { ...this.state.settings, ...data.settings };
                        }
                        
                        this.saveData();
                        this.updateUI();
                        this.showToast('Data imported successfully', 'success');
                        
                        // Clear file input
                        event.target.value = '';
                    } catch (error) {
                        console.error('Import error:', error);
                        this.showToast('Error importing data. Invalid file format.', 'error');
                    }
                };
                
                reader.readAsText(file);
            }
            
            // Backup Management
            createBackup() {
                const backups = JSON.parse(localStorage.getItem('moneyTrackerBackups') || '[]');
                const backup = {
                    id: Date.now(),
                    data: {
                        transactions: this.state.transactions,
                        budget: this.state.budget,
                        customCategories: this.state.customCategories,
                        settings: this.state.settings
                    },
                    createdAt: new Date().toISOString(),
                    size: JSON.stringify(this.state.transactions).length
                };
                
                backups.unshift(backup);
                
                // Keep only last 10 backups
                if (backups.length > 10) {
                    backups.pop();
                }
                
                localStorage.setItem('moneyTrackerBackups', JSON.stringify(backups));
                this.showToast('Backup created successfully', 'success');
            }
            
            showBackupModal() {
                this.showToast('Backup management will be available in the next update', 'info');
            }
            
            // About
            showAbout() {
                const modal = document.getElementById('about-modal');
                modal.classList.remove('hidden');
                
                setTimeout(() => {
                    const sheet = modal.querySelector('.bottom-sheet');
                    sheet.classList.remove('bottom-sheet-closed');
                    sheet.classList.add('bottom-sheet-open');
                }, 10);
            }
            
            closeAbout() {
                const modal = document.getElementById('about-modal');
                const sheet = modal.querySelector('.bottom-sheet');
                
                sheet.classList.remove('bottom-sheet-open');
                sheet.classList.add('bottom-sheet-closed');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
            
            // Recurring Transactions
            checkRecurringTransactions() {
                const lastCheck = localStorage.getItem('lastRecurringCheck');
                const currentMonth = new Date().getMonth();
                
                if (lastCheck != currentMonth) {
                    const recurring = this.state.transactions.filter(t => t.recurring);
                    
                    if (recurring.length > 0) {
                        // Show notification
                        this.showToast(`You have ${recurring.length} recurring transactions to review`, 'info');
                    }
                    
                    localStorage.setItem('lastRecurringCheck', currentMonth);
                }
            }
            
            // Service Worker
            setupServiceWorker() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js').then(() => {
                        console.log('Service Worker registered');
                    }).catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
                }
            }
            
            // Online/Offline Status
            checkOnlineStatus() {
                const offlineIndicator = document.getElementById('offline-indicator');
                
                if (!navigator.onLine) {
                    offlineIndicator.classList.remove('hidden');
                }
                
                window.addEventListener('online', () => {
                    offlineIndicator.classList.add('hidden');
                    this.showToast('You are back online', 'success');
                });
                
                window.addEventListener('offline', () => {
                    offlineIndicator.classList.remove('hidden');
                    this.showToast('You are offline. Some features may be limited.', 'warning');
                });
            }
            
            // Pagination
            loadMoreTransactions() {
                this.state.pagination.page++;
                this.renderTransactions();
            }
            
            // Clear All Data
            clearAllData() {
                if (!confirm('⚠️ WARNING: This will delete ALL your data. This action cannot be undone. Are you sure?')) {
                    return;
                }
                
                if (!confirm('Are you absolutely sure? All your financial data will be permanently deleted.')) {
                    return;
                }
                
                localStorage.clear();
                this.state = {
                    transactions: [],
                    budget: 0,
                    customCategories: [],
                    settings: {
                        darkMode: 'auto',
                        currency: 'INR',
                        language: 'en',
                        dateFormat: 'DD/MM/YYYY',
                        budgetAlerts: true,
                        autoBackup: false,
                        cloudSync: false,
                        autoBudget: false
                    },
                    filters: {
                        search: '',
                        type: 'all',
                        category: 'all',
                        startDate: null,
                        endDate: null,
                        minAmount: null,
                        maxAmount: null,
                        paymentMethod: 'all',
                        status: 'all',
                        sortBy: 'date',
                        sortOrder: 'desc'
                    },
                    pagination: {
                        page: 1,
                        limit: 20,
                        hasMore: true
                    },
                    currentView: 'home',
                    currentTransactionType: 'expense',
                    selectedCategory: null,
                    analyticsPeriod: 'month'
                };
                
                this.saveData();
                this.updateUI();
                this.showToast('All data has been reset', 'info');
            }
            
            // Event Listeners
            setupEventListeners() {
                
                
                // Search toggle
                document.getElementById('search-toggle').addEventListener('click', () => {
                    const searchBar = document.getElementById('search-bar');
                    searchBar.classList.toggle('hidden');
                    
                    if (!searchBar.classList.contains('hidden')) {
                        document.getElementById('search-input').focus();
                    }
                });
                
                // Search input with debounce
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        clearTimeout(this.debounceTimers.search);
                        this.debounceTimers.search = setTimeout(() => {
                            this.state.filters.search = e.target.value;
                            this.state.pagination.page = 1;
                            this.renderTransactions();
                        }, 300);
                    });
                }
                
                // Clear search
                document.getElementById('clear-search').addEventListener('click', () => {
                    document.getElementById('search-input').value = '';
                    this.state.filters.search = '';
                    this.state.pagination.page = 1;
                    this.renderTransactions();
                });
                
                // Note character counter
                const noteInput = document.getElementById('inp-note');
                if (noteInput) {
                    noteInput.addEventListener('input', (e) => {
                        const count = e.target.value.length;
                        document.getElementById('note-count').textContent = `${count}/100`;
                    });
                }
                
                // Analytics period change
                const analyticsPeriod = document.getElementById('analytics-period');
                if (analyticsPeriod) {
                    analyticsPeriod.addEventListener('change', (e) => {
                        this.state.analyticsPeriod = e.target.value;
                        this.renderCharts();
                    });
                }
                
                // Budget alerts toggle
                const budgetAlerts = document.getElementById('budget-alerts');
                if (budgetAlerts) {
                    budgetAlerts.addEventListener('change', (e) => {
                        this.state.settings.budgetAlerts = e.target.checked;
                        this.saveData();
                    });
                }
                
                // Auto backup toggle
                const autoBackup = document.getElementById('auto-backup');
                if (autoBackup) {
                    autoBackup.addEventListener('change', (e) => {
                        this.state.settings.autoBackup = e.target.checked;
                        this.saveData();
                    });
                }
                
                // Cloud sync toggle
                const cloudSync = document.getElementById('cloud-sync');
                if (cloudSync) {
                    cloudSync.addEventListener('change', (e) => {
                        this.state.settings.cloudSync = e.target.checked;
                        this.saveData();
                    });
                }
                
                // Auto budget toggle
                const autoBudget = document.getElementById('auto-budget');
                if (autoBudget) {
                    autoBudget.addEventListener('change', (e) => {
                        this.state.settings.autoBudget = e.target.checked;
                        this.saveData();
                    });
                }
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + E to add expense
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        this.openAddModal('expense');
                    }
                    
                    // Ctrl/Cmd + I to add income
                    if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
                        e.preventDefault();
                        this.openAddModal('income');
                    }
                    
                    // Escape to close modals
                    if (e.key === 'Escape') {
                        if (!document.getElementById('add-modal').classList.contains('hidden')) {
                            this.closeAddModal();
                        }
                        if (!document.getElementById('category-manager-modal').classList.contains('hidden')) {
                            this.closeCategoryManager();
                        }
                        if (!document.getElementById('filter-modal').classList.contains('hidden')) {
                            this.closeFilterModal();
                        }
                        if (!document.getElementById('about-modal').classList.contains('hidden')) {
                            this.closeAbout();
                        }
                    }
                });
                
                // Pull to refresh
                let startY = 0;
                let currentY = 0;
                const pullThreshold = 100;
                const pullElement = document.getElementById('pull-to-refresh');
                
                document.addEventListener('touchstart', (e) => {
                    if (this.state.currentView === 'home' && window.scrollY === 0) {
                        startY = e.touches[0].pageY;
                    }
                }, { passive: true });
                
                document.addEventListener('touchmove', (e) => {
                    if (startY && window.scrollY === 0) {
                        currentY = e.touches[0].pageY;
                        const diff = currentY - startY;
                        
                        if (diff > 0) {
                            e.preventDefault();
                            pullElement.style.transform = `translateY(${Math.min(diff, pullThreshold)}px)`;
                        }
                    }
                }, { passive: false });
                
                document.addEventListener('touchend', () => {
                    if (startY && window.scrollY === 0) {
                        const diff = currentY - startY;
                        
                        if (diff > pullThreshold) {
                            // Trigger refresh
                            pullElement.style.transform = 'translateY(0)';
                            this.showToast('Refreshing data...', 'info');
                            setTimeout(() => {
                                this.updateUI();
                                this.showToast('Data refreshed', 'success');
                            }, 1000);
                        } else {
                            pullElement.style.transform = 'translateY(-100%)';
                        }
                        
                        startY = 0;
                        currentY = 0;
                    }
                });
            }
            
            // Toast Notifications
            showToast(message, type = 'info') {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                const typeClasses = {
                    success: 'bg-green-600 text-white',
                    error: 'bg-red-600 text-white',
                    warning: 'bg-yellow-600 text-white',
                    info: 'bg-gray-800 text-white dark:bg-gray-700'
                };
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                
                toast.className = `${typeClasses[type]} px-4 py-3 rounded-lg shadow-lg text-sm font-medium toast-enter pointer-events-auto flex items-center space-x-2 min-w-[200px] max-w-[300px]`;
                toast.innerHTML = `
                    <i class="fas ${icons[type]}"></i>
                    <span>${message}</span>
                `;
                
                container.appendChild(toast);
                
                // Auto-remove after 3 seconds
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(10px)';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            // Utility Functions
            formatDate(date) {
                const format = this.state.settings.dateFormat;
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                
                switch (format) {
                    case 'DD/MM/YYYY':
                        return `${day}/${month}/${year}`;
                    case 'MM/DD/YYYY':
                        return `${month}/${day}/${year}`;
                    case 'YYYY-MM-DD':
                        return `${year}-${month}-${day}`;
                    case 'DD MMM YYYY':
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return `${day} ${monthNames[date.getMonth()]} ${year}`;
                    default:
                        return `${day}/${month}/${year}`;
                }
            }
            
            formatDateTime(dateTimeString) {
                const date = new Date(dateTimeString);
                return date.toLocaleTimeString(this.state.settings.language, {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            editProfile() {
                this.showToast('Profile editing will be available in the next update', 'info');
            }
            
            openDateRangePicker() {
                this.showToast('Date range picker will be available in the next update', 'info');
            }
            
            openCategoryFilter() {
                this.openFilterModal();
            }
            
            openSortModal() {
                this.showToast('Sort options will be available in the next update', 'info');
            }
            
            updateAnalyticsPeriod(period) {
                this.state.analyticsPeriod = period;
                this.renderCharts();
            }
            
            toggleChartType(chartId) {
                this.showToast('Chart type toggle will be available in the next update', 'info');
            }
            
            downloadChart(chartId) {
                this.showToast('Chart download will be available in the next update', 'info');
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new MoneyTrackerApp();
        });
        
        // Save data before page unload
        window.addEventListener('beforeunload', () => {
            if (window.app) {
                window.app.saveData();
            }
        });
    </script>
</body>
</html>